<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IdealFit - Merchant Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #1a202c;
            line-height: 1.6;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 100%);
            padding: 2rem 0;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .user-section {
            padding: 1.5rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }
        
        .user-info-sidebar {
            flex: 1;
        }
        
        .user-name {
            color: white;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 4px;
        }
        
        .user-email {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
        }
        
        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0 1rem;
        }
        
        .tab {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
            color: rgba(255, 255, 255, 0.8);
            border-left: 3px solid transparent;
            margin: 4px 0;
        }
        
        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: #60a5fa;
            color: white;
            transform: translateX(4px);
        }
        
        .tab.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-weight: 600;
            border-left-color: #60a5fa;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .tab-icon {
            font-size: 1.3rem;
            opacity: 0.9;
        }
        
        .tab-label {
            flex: 1;
        }
        
        .main-content {
            flex: 1;
            padding: 2rem;
            background: #f8fafc;
        }
        
        .page-header {
            margin-bottom: 2rem;
        }
        
        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .page-subtitle {
            color: #718096;
            font-size: 1.1rem;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }
        
        .logout-section {
            margin-top: auto;
            padding: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logout-btn {
            width: 100%;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
            color: rgba(239, 68, 68, 0.9);
            margin: 4px 0;
        }
        
        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            transform: translateX(4px);
        }
        
        /* Quick Filter Buttons */
        .quick-filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #374151;
        }
        
        .quick-filter-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }
        
        .quick-filter-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        /* Button Styles */
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        /* Insights Table */
        .insights-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .insights-table th {
            background: #f8fafc;
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
        }
        
        .insights-table td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .insights-table tr:hover {
            background: #f8fafc;
        }
        
        /* Priority Badge */
        .priority-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .priority-badge.high {
            background: #dcfce7;
            color: #166534;
        }
        
        .priority-badge.medium {
            background: #fef3c7;
            color: #92400e;
        }
        
        .priority-badge.low {
            background: #fecaca;
            color: #991b1b;
        }
        
        /* Recommendation Cards */
        .recommendation-card {
            padding: 1.5rem;
            border-radius: 12px;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .recommendation-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white"/><circle cx="75" cy="75" r="1" fill="white"/><circle cx="50" cy="10" r="0.5" fill="white"/><circle cx="10" cy="60" r="0.5" fill="white"/><circle cx="90" cy="40" r="0.5" fill="white"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        }
        
        .recommendation-card.top-performers {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .recommendation-card.high-demand {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }
        
        .recommendation-header {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }
        
        .recommendation-metric {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .recommendation-description {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }
        
        .recommendation-focus {
            font-size: 0.875rem;
            opacity: 0.95;
        }
        
        .recommendation-focus ul {
            margin: 0.5rem 0 0 1rem;
            list-style: none;
        }
        
        .recommendation-focus li {
            margin-bottom: 0.25rem;
        }
        
        .recommendation-focus input[type="checkbox"] {
            margin-right: 0.5rem;
        }
        
        /* Customer Table */
        .customer-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .customer-table th {
            background: #f8fafc;
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .customer-table td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .customer-table tr:hover {
            background: #f8fafc;
        }
        
        /* Size Badges */
        .size-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .size-badge.size-s {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .size-badge.size-m {
            background: #dcfce7;
            color: #166534;
        }
        
        .size-badge.size-l {
            background: #fef3c7;
            color: #92400e;
        }
        
        .size-badge.size-xl {
            background: #fecaca;
            color: #991b1b;
        }
        
        .size-badge.size-xs {
            background: #e5e7eb;
            color: #374151;
        }
        
        .size-badge.size-xxl {
            background: #ddd6fe;
            color: #7c3aed;
        }
        
        /* Modern Button Styles */
        .modern-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            outline: none;
        }
        
        .modern-btn.secondary-btn {
            background: #ffffff;
            color: #6b7280;
            border: 1px solid #d1d5db;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        
        .modern-btn.secondary-btn:hover {
            background: #f9fafb;
            border-color: #9ca3af;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .modern-btn.primary-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }
        
        .modern-btn.primary-btn:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
            transform: translateY(-1px);
        }
        
        .modern-btn:active {
            transform: translateY(0);
        }
        
        .modern-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #ef4444 0%, #ffffff 50%, #3b82f6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .logo-icon::before {
            content: 'ðŸŽ¯';
            font-size: 20px;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .logo-text {
            color: white;
            font-size: 1.25rem;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .notification-bell {
            color: #fbbf24;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .notification-bell:hover {
            color: #f59e0b;
            transform: scale(1.1);
        }
        
        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: #ef4444;
            color: white;
            font-size: 0.625rem;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
            border: 2px solid white;
        }
        
        .header-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            backdrop-filter: blur(10px);
        }
        
        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .header-btn:active {
            transform: translateY(0);
        }
        
        /* Settings Modal Styles */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .settings-modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .settings-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .settings-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px 16px 0 0;
        }

        .settings-title {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .settings-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .settings-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .settings-tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }

        .settings-tab {
            flex: 1;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border-bottom: 3px solid transparent;
        }

        .settings-tab:hover {
            background: #f1f5f9;
            color: #374151;
        }

        .settings-tab.active {
            background: white;
            color: #1e3a8a;
            border-bottom-color: #3b82f6;
            font-weight: 600;
        }

        .settings-tab-content {
            padding: 2rem;
        }

        .settings-section {
            margin-bottom: 2rem;
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e3a8a;
        }

        .settings-section-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .settings-form-group {
            margin-bottom: 1.5rem;
        }

        .settings-form-group:last-child {
            margin-bottom: 0;
        }

        .settings-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
            font-size: 0.875rem;
        }

        .settings-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            background: white;
        }

        .settings-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .settings-description {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
            line-height: 1.4;
        }

        .settings-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .settings-button:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .settings-button:active {
            transform: translateY(0);
        }

        /* Payment Modal Styles */
        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            backdrop-filter: blur(5px);
        }

        .payment-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        .payment-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px 16px 0 0;
        }

        .payment-title {
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .payment-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .payment-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .payment-body {
            padding: 2rem;
        }

        .payment-amount {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }

        .payment-amount h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 0.5rem;
        }

        .payment-amount p {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .payment-methods h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 1rem;
        }

        .payment-option {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .payment-option:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }

        .payment-option.selected {
            border-color: #3b82f6;
            background: #f0f9ff;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .payment-option-content {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            gap: 1rem;
        }

        .payment-option-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .payment-option-icon img {
            width: 32px;
            height: 32px;
            border-radius: 4px;
        }

        .payment-option-info {
            flex: 1;
        }

        .payment-option-info h5 {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .payment-option-info p {
            font-size: 0.875rem;
            color: #6b7280;
            margin: 0;
        }

        .payment-option-radio {
            display: flex;
            align-items: center;
        }

        .payment-option-radio input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: #3b82f6;
        }

        .payment-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: flex-end;
        }

        .payment-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .payment-button.secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .payment-button.secondary:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }

        .payment-button.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }

        .payment-button.primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
            transform: translateY(-1px);
        }

        /* Integration Status Styles */
        .integration-status {
            margin-bottom: 2rem;
        }

        .status-card {
            display: flex;
            align-items: center;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .status-card.connected {
            border-color: #22c55e;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }

        .status-card.disconnected {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
        }

        .status-icon {
            font-size: 2rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .status-info {
            flex: 1;
        }

        .status-info h5 {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .status-info p {
            font-size: 0.875rem;
            color: #6b7280;
            margin: 0;
        }

        .integration-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        /* Toggle Switch Styles */
        .toggle-switch {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .toggle-switch input[type="checkbox"] {
            display: none;
        }

        .toggle-label {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            background: #d1d5db;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-label:hover {
            background: #9ca3af;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch input[type="checkbox"]:checked + .toggle-label {
            background: #3b82f6;
        }

        .toggle-switch input[type="checkbox"]:checked + .toggle-label .toggle-slider {
            transform: translateX(26px);
        }

        .toggle-switch input[type="checkbox"]:checked + .toggle-label:hover {
            background: #2563eb;
        }
        .notification-panel {
            position: absolute;
            top: 100%;
            right: 0;
            width: 350px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e7eb;
            z-index: 1000;
            display: none;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .notification-panel.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .notification-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            background: #f8fafc;
            border-radius: 12px 12px 0 0;
        }
        
        .notification-title {
            font-size: 1rem;
            font-weight: 600;
            color: #1e3a8a;
            margin: 0;
        }
        
        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid #f3f4f6;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .notification-item:hover {
            background: #f8fafc;
        }
        
        .notification-item:last-child {
            border-bottom: none;
        }
        
        .notification-content {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }
        
        .notification-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            flex-shrink: 0;
        }
        
        .notification-icon.info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .notification-icon.success {
            background: #dcfce7;
            color: #166534;
        }
        
        .notification-icon.warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .notification-icon.error {
            background: #fecaca;
            color: #991b1b;
        }
        
        .notification-text {
            flex: 1;
        }
        
        .notification-message {
            font-size: 0.875rem;
            color: #374151;
            margin-bottom: 0.25rem;
            line-height: 1.4;
        }
        
        .notification-time {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .notification-empty {
            padding: 2rem;
            text-align: center;
            color: #6b7280;
        }
        
        .notification-empty-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Error States */
        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .header {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .customer-table {
                font-size: 0.75rem;
            }
            
            .customer-table th,
            .customer-table td {
                padding: 8px;
            }
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: border-color 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            background: white;
            cursor: pointer;
        }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        
        /* Chart Container */
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            margin: 1rem 0;
        }
        
        .chart-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 400px;
            background: #f8fafc;
            border-radius: 12px;
            color: #6b7280;
        }
        
        .chart-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 400px;
            background: #fef2f2;
            border-radius: 12px;
            color: #991b1b;
        }
        
        /* Real-time Indicators */
        .realtime-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: #dcfce7;
            color: #166534;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .realtime-indicator::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Data Refresh Controls */
        .refresh-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .auto-refresh-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .auto-refresh-toggle input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #3b82f6;
        }
        
        .refresh-interval {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        /* Dynamic KPI Cards */
        .stat-card.dynamic {
            position: relative;
            overflow: hidden;
        }
        
        .stat-card.dynamic::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .stat-card.updating {
            opacity: 0.7;
        }
        
        .stat-card.error {
            border-left: 4px solid #ef4444;
        }
        
        /* Trend Indicators */
        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            margin-top: 0.5rem;
        }
        
        .trend-up {
            color: #22c55e;
        }
        
        .trend-down {
            color: #ef4444;
        }
        
        .trend-neutral {
            color: #6b7280;
        }
        
        /* Advanced Filters */
        .advanced-filters {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e5e7eb;
        }
        
        .filter-section {
            margin-bottom: 1rem;
        }
        
        .filter-section:last-child {
            margin-bottom: 0;
        }
        
        .filter-section h4 {
            color: #374151;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .filter-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: #e5e7eb;
            color: #374151;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .filter-tag.active {
            background: #3b82f6;
            color: white;
        }
        
        .filter-tag .remove {
            cursor: pointer;
            font-weight: bold;
        }
        
        /* Data Table Enhancements */
        .data-table-container {
            position: relative;
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }
        
        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .table-search {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .table-search input {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            width: 200px;
        }
        
        .table-pagination {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .pagination-btn {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        .pagination-btn:hover {
            background: #f3f4f6;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: 12px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Export Options */
        .export-options {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .export-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }
        
        .export-btn.primary {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        /* Size Chart Styles */
        .unit-toggle-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #374151;
        }
        
        .unit-toggle-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }
        
        .unit-toggle-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .size-chart-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .size-chart-table th {
            background: #f8fafc;
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .size-chart-table td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .size-chart-table tr:hover {
            background: #f8fafc;
        }
        
        .size-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            text-align: center;
            transition: border-color 0.3s ease;
        }
        
        .size-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .size-input.error {
            border-color: #ef4444;
            background: #fef2f2;
        }
        
        .delete-btn {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        
        .delete-btn:hover {
            background: #fecaca;
            border-color: #f87171;
        }
        
        /* Notification Toast Styles */
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e7eb;
            z-index: 10000;
            min-width: 300px;
            max-width: 400px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .notification-toast.show {
            transform: translateX(0);
        }
        
        .notification-toast-header {
            padding: 1rem 1rem 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .notification-toast-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            flex-shrink: 0;
        }
        
        .notification-toast-icon.success {
            background: #dcfce7;
            color: #166534;
        }
        
        .notification-toast-icon.info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .notification-toast-icon.warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .notification-toast-icon.error {
            background: #fecaca;
            color: #991b1b;
        }
        
        .notification-toast-content {
            flex: 1;
        }
        
        .notification-toast-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1e3a8a;
            margin: 0;
        }
        
        .notification-toast-message {
            font-size: 0.875rem;
            color: #6b7280;
            margin: 0.25rem 0 0 0;
            line-height: 1.4;
        }
        
        .notification-toast-body {
            padding: 0 1rem 1rem 1rem;
        }
        
        .notification-toast-close {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 1.25rem;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        /* Billing Page Styles */
        .billing-plan-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .billing-plan-card:hover {
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }
        
        .billing-plan-card.professional {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .billing-plan-card.professional .plan-title,
        .billing-plan-card.professional .plan-subtitle,
        .billing-plan-card.professional .plan-price,
        .billing-plan-card.professional .plan-volume,
        .billing-plan-card.professional .feature-section,
        .billing-plan-card.professional .feature-item {
            color: white;
        }
        
        .plan-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .plan-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .plan-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 0.5rem;
        }
        
        .plan-subtitle {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .plan-price {
            font-size: 2rem;
            font-weight: 700;
            color: #1e3a8a;
            text-align: center;
            margin-bottom: 0.5rem;
        }
        
        .plan-volume {
            color: #6b7280;
            text-align: center;
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
        }
        
        .plan-features {
            margin-bottom: 2rem;
        }
        
        .feature-section {
            font-weight: 600;
            color: #1e3a8a;
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
        }
        
        .feature-item {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }
        
        .plan-button {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .plan-button:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }
        
        .plan-button.professional {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Currency Toggle Styles */
        .currency-toggle-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #374151;
        }
        
        .currency-toggle-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }
        
        .currency-toggle-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <div class="logo">
                <div class="logo-icon"></div>
                <div class="logo-text">IdealFit Merchant Dashboard</div>
            </div>
        </div>
        
        <div class="header-right">
            <div class="notification-bell" onclick="toggleNotifications()">
                ðŸ””
                <span class="notification-badge" id="notificationCount">3</span>
            </div>
            <button class="header-btn" onclick="openSettings()">
                âš™ï¸ Settings
            </button>
            <button class="header-btn" onclick="logout()">
                ðŸšª Logout
            </button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <div class="settings-header">
                <div class="settings-title">
                    âš™ï¸ Settings
                </div>
                <button class="settings-close" onclick="closeSettings()">
                    Ã—
                </button>
            </div>
            
            <div class="settings-tabs">
                <button class="settings-tab active" onclick="showSettingsTab('info')">
                    ðŸ‘¤ Info
                </button>
                <button class="settings-tab" onclick="showSettingsTab('billing')">
                    ðŸ’° Billing
                </button>
                <button class="settings-tab" onclick="showSettingsTab('integration')">
                    ðŸ”— Integration
                </button>
            </div>
            
            <div class="settings-tab-content">
                <!-- Info Tab -->
                <div id="settings-info" class="settings-tab-panel active">
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <div class="settings-section-icon">ðŸ‘¤</div>
                            Account Information
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Customer ID</label>
                            <input type="text" class="settings-input" value="CUST-37918" readonly>
                            <div class="settings-description">Your unique customer identifier</div>
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Email</label>
                            <input type="email" class="settings-input" value="ms@gm" placeholder="Enter your email">
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <div class="settings-section-icon">ðŸ”’</div>
                            Change Password
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Current Password</label>
                            <input type="password" class="settings-input" placeholder="Enter current password">
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">New Password</label>
                            <input type="password" class="settings-input" placeholder="Enter new password">
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Confirm New Password</label>
                            <input type="password" class="settings-input" placeholder="Confirm new password">
                        </div>
                        
                        <button class="settings-button" onclick="updatePassword()">
                            ðŸ”„ Update Password
                        </button>
                    </div>
                </div>
                
                <!-- Billing Tab -->
                <div id="settings-billing" class="settings-tab-panel" style="display: none;">
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <div class="settings-section-icon">ðŸ’°</div>
                            Billing Information
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Current Plan</label>
                            <input type="text" class="settings-input" value="Professional Plan" readonly>
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Billing Cycle</label>
                            <input type="text" class="settings-input" value="Monthly" readonly>
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Next Billing Date</label>
                            <input type="text" class="settings-input" value="December 15, 2024" readonly>
                        </div>
                        
                        <button class="settings-button" onclick="showPaymentOptions()">
                            ðŸ’³ Make Payment
                        </button>
                        
                        <!-- Payment Options Modal -->
                        <div id="paymentOptionsModal" class="payment-modal" style="display: none;">
                            <div class="payment-content">
                                <div class="payment-header">
                                    <div class="payment-title">
                                        ðŸ’³ Make Payment
                                    </div>
                                    <button class="payment-close" onclick="closePaymentOptions()">
                                        Ã—
                                    </button>
                                </div>
                                
                                <div class="payment-body">
                                    <div class="payment-amount">
                                        <h3>Amount Due: â‚¹2,999.00</h3>
                                        <p>Professional Plan - Monthly Billing</p>
                                    </div>
                                    
                                    <div class="payment-methods">
                                        <h4>Choose Payment Method:</h4>
                                        
                                        <div class="payment-option" onclick="selectPaymentMethod('razorpay')">
                                            <div class="payment-option-content">
                                                <div class="payment-option-icon">
                                                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzMzNjZGRiIvPgo8cGF0aCBkPSJNMTIgMTZIMjhWMjRIMTJWMTZaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMTQgMThIMjZWMjJIMTRWMThaIiBmaWxsPSIjMzM2NkZGIi8+Cjwvc3ZnPgo=" alt="Razorpay" />
                                                </div>
                                                <div class="payment-option-info">
                                                    <h5>Razorpay</h5>
                                                    <p>Pay with UPI, Cards, Net Banking</p>
                                                </div>
                                                <div class="payment-option-radio">
                                                    <input type="radio" name="paymentMethod" value="razorpay" id="razorpay">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="payment-option" onclick="selectPaymentMethod('stripe')">
                                            <div class="payment-option-content">
                                                <div class="payment-option-icon">
                                                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzYzNTJGRiIvPgo8cGF0aCBkPSJNMTIgMTZIMjhWMjRIMTJWMTZaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMTQgMThIMjZWMjJIMTRWMThaIiBmaWxsPSIjNjM1MkZGIi8+Cjwvc3ZnPgo=" alt="Stripe" />
                                                </div>
                                                <div class="payment-option-info">
                                                    <h5>Stripe</h5>
                                                    <p>Pay with Cards, Apple Pay, Google Pay</p>
                                                </div>
                                                <div class="payment-option-radio">
                                                    <input type="radio" name="paymentMethod" value="stripe" id="stripe">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="payment-actions">
                                        <button class="payment-button secondary" onclick="closePaymentOptions()">
                                            Cancel
                                        </button>
                                        <button class="payment-button primary" onclick="processPayment()" id="processPaymentBtn" disabled>
                                            Proceed to Payment
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Integration Tab -->
                <div id="settings-integration" class="settings-tab-panel" style="display: none;">
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <div class="settings-section-icon">ðŸ›ï¸</div>
                            Shopify Integration
                        </div>
                        
                        <div class="integration-status">
                            <div class="status-card connected">
                                <div class="status-icon">âœ…</div>
                                <div class="status-info">
                                    <h5>Connected to Shopify</h5>
                                    <p>Your IdealFit account is successfully integrated with your Shopify store</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Shopify Store Name</label>
                            <input type="text" class="settings-input" value="ideal-fit-store.myshopify.com" readonly>
                            <div class="settings-description">Your connected Shopify store domain</div>
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Store Owner</label>
                            <input type="text" class="settings-input" value="Merchant Store Owner" readonly>
                            <div class="settings-description">Primary contact for this Shopify store</div>
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Integration Date</label>
                            <input type="text" class="settings-input" value="October 15, 2024" readonly>
                            <div class="settings-description">When your store was first connected to IdealFit</div>
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Last Sync</label>
                            <input type="text" class="settings-input" value="Just now" readonly>
                            <div class="settings-description">Last time data was synchronized between platforms</div>
                        </div>
                        
                        <div class="integration-actions">
                            <button class="settings-button" onclick="syncShopifyData()">
                                ðŸ”„ Sync Data Now
                            </button>
                            <button class="settings-button" onclick="disconnectShopify()" style="background: #ef4444; margin-left: 0.5rem;">
                                ðŸš« Disconnect Store
                            </button>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <div class="settings-section-icon">ðŸ”—</div>
                            API Integration
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">API Key</label>
                            <input type="text" class="settings-input" value="sk-ideal-fit-abc123..." readonly>
                            <div class="settings-description">Your unique API key for integrations</div>
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Webhook URL</label>
                            <input type="url" class="settings-input" placeholder="https://your-domain.com/webhook">
                        </div>
                        
                        <button class="settings-button" onclick="regenerateApiKey()">
                            ðŸ”„ Regenerate API Key
                        </button>
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <div class="settings-section-icon">âš™ï¸</div>
                            Integration Settings
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Auto Sync</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="autoSync" checked>
                                <label for="autoSync" class="toggle-label">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-description">Automatically sync customer data every 15 minutes</div>
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Size Chart Sync</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="sizeChartSync" checked>
                                <label for="sizeChartSync" class="toggle-label">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-description">Sync size chart updates to your Shopify store</div>
                        </div>
                        
                        <div class="settings-form-group">
                            <label class="settings-label">Order Tracking</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="orderTracking" checked>
                                <label for="orderTracking" class="toggle-label">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-description">Track orders and update size recommendations</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <!-- User Section -->
            <div class="user-section">
                <div class="user-avatar">
                    ðŸª
                </div>
                <div class="user-info-sidebar">
                    <div class="user-name">Merchant Store</div>
                    <div class="user-email">store@example.com</div>
                </div>
            </div>

            <div class="sidebar-nav">
                <button class="tab active" onclick="showTab('analytics')">
                    <span class="tab-icon">ðŸ“Š</span>
                    <span class="tab-label">Analytics</span>
                </button>
                <button class="tab" onclick="showTab('customers')">
                    <span class="tab-icon">ðŸ‘¥</span>
                    <span class="tab-label">Customer Database</span>
                </button>
                <button class="tab" onclick="showTab('sizechart')">
                    <span class="tab-icon">ðŸ“</span>
                    <span class="tab-label">Size Chart</span>
                </button>
                <button class="tab" onclick="showTab('billing')">
                    <span class="tab-icon">ðŸ’°</span>
                    <span class="tab-label">Billing</span>
                </button>
            </div>
            
            <!-- Logout Button -->
            <div class="logout-section">
                <button class="logout-btn" onclick="logout()">
                    <span class="tab-icon">ðŸšª</span>
                    <span class="tab-label">Logout</span>
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Analytics Tab -->
            <div id="analytics" class="tab-content active">
                <div class="page-header">
                    <h1 class="page-title">ðŸ“Š Analytics & Size Comparison</h1>
                    <p class="page-subtitle">Understand your customer measurements and optimize production</p>
                    <div class="realtime-indicator" id="realtimeIndicator">
                        Live Data
                    </div>
                </div>

                <!-- Real-time Controls -->
                <div class="card">
                    <div class="refresh-controls">
                        <div class="auto-refresh-toggle">
                            <input type="checkbox" id="autoRefresh" checked>
                            <label for="autoRefresh">Auto-refresh data</label>
                        </div>
                        <div class="refresh-interval" id="refreshInterval">Next update in 30s</div>
                        <button class="modern-btn secondary-btn" onclick="refreshAnalyticsData()">
                            ðŸ”„ Refresh Now
                        </button>
                    </div>
                </div>

                <!-- Advanced Filters -->
                <div class="card">
                    <h2 style="color: #1e3a8a; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 8px;">
                        ðŸ” Advanced Filters
                    </h2>
                    
                    <div class="advanced-filters">
                        <div class="filter-section">
                            <h4>Date Range</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">From Date</label>
                                    <input type="date" class="form-input" id="analyticsFromDate">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">To Date</label>
                                    <input type="date" class="form-input" id="analyticsToDate">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Month</label>
                                    <select class="form-select" id="analyticsMonth">
                                        <option value="">All Months</option>
                                        <option value="January">January</option>
                                        <option value="February">February</option>
                                        <option value="March">March</option>
                                        <option value="April">April</option>
                                        <option value="May">May</option>
                                        <option value="June">June</option>
                                        <option value="July">July</option>
                                        <option value="August">August</option>
                                        <option value="September">September</option>
                                        <option value="October">October</option>
                                        <option value="November">November</option>
                                        <option value="December">December</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Year</label>
                                    <select class="form-select" id="analyticsYear">
                                        <option value="">All Years</option>
                                        <option value="2024">2024</option>
                                        <option value="2023">2023</option>
                                        <option value="2022">2022</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="filter-section">
                            <h4>Quick Filters</h4>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <button class="quick-filter-btn" onclick="setQuickFilter('today', this)">Today</button>
                                <button class="quick-filter-btn" onclick="setQuickFilter('week', this)">This Week</button>
                                <button class="quick-filter-btn" onclick="setQuickFilter('month', this)">This Month</button>
                                <button class="quick-filter-btn" onclick="setQuickFilter('quarter', this)">This Quarter</button>
                                <button class="quick-filter-btn" onclick="setQuickFilter('year', this)">This Year</button>
                                <button class="quick-filter-btn" onclick="setQuickFilter('all', this)">All Time</button>
                            </div>
                        </div>

                        <div class="filter-section">
                            <h4>Active Filters</h4>
                            <div class="filter-tags" id="activeFilters">
                                <!-- Active filters will be displayed here -->
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 0.75rem; justify-content: flex-end; margin-top: 1rem;">
                        <button class="modern-btn secondary-btn" onclick="clearFilters()">
                            Clear Filters
                        </button>
                        <button class="modern-btn primary-btn" onclick="applyFilters(this)">
                            ðŸ” Apply Filters
                        </button>
                        <div class="export-options">
                            <button class="export-btn" onclick="exportData('csv')">
                                ðŸ“Š CSV
                            </button>
                            <button class="export-btn" onclick="exportData('excel')">
                                ðŸ“ˆ Excel
                            </button>
                            <button class="export-btn" onclick="exportData('pdf')">
                                ðŸ“„ PDF
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Dynamic KPI Cards -->
                <div class="stats-grid">
                    <div class="stat-card dynamic" id="totalOrdersCard">
                        <div class="stat-icon">ðŸ“¦</div>
                        <div class="stat-number" id="totalOrders">-</div>
                        <div class="stat-label">Total Orders</div>
                        <div class="trend-indicator" id="totalOrdersTrend">
                            <span class="trend-neutral">â†” No change</span>
                        </div>
                    </div>
                    <div class="stat-card dynamic" id="uniqueCustomersCard">
                        <div class="stat-icon">ðŸ‘¤</div>
                        <div class="stat-number" id="uniqueCustomers">-</div>
                        <div class="stat-label">Unique Customers</div>
                        <div class="trend-indicator" id="uniqueCustomersTrend">
                            <span class="trend-neutral">â†” No change</span>
                        </div>
                    </div>
                    <div class="stat-card dynamic" id="mostPopularSizeCard">
                        <div class="stat-icon">ðŸ“</div>
                        <div class="stat-number" id="mostPopularSize">-</div>
                        <div class="stat-label">Most Popular Size</div>
                        <div class="trend-indicator" id="mostPopularSizeTrend">
                            <span class="trend-neutral">â†” No change</span>
                        </div>
                    </div>
                    <div class="stat-card dynamic" id="returnReductionCard">
                        <div class="stat-icon">ðŸ“ˆ</div>
                        <div class="stat-number" id="returnReduction">-</div>
                        <div class="stat-label">Est. Return Reduction</div>
                        <div class="trend-indicator" id="returnReductionTrend">
                            <span class="trend-neutral">â†” No change</span>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Size Distribution Chart -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: #1e3a8a; display: flex; align-items: center; gap: 8px;">
                            ðŸ“Š Size Distribution
                        </h2>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <select class="form-select" style="width: auto;" id="chartPeriod">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly" selected>Monthly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                            <button class="modern-btn primary-btn" onclick="exportSizeDistribution()">
                                ðŸ“Š Export Chart
                            </button>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="sizeDistributionChart"></canvas>
                        <div class="loading-overlay hidden" id="chartLoading">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Size Comparison & Production Insights -->
                <div class="card">
                    <h2 style="color: #1e3a8a; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 8px;">
                        âœ… Size Comparison & Production Insights
                    </h2>
                    
                    <div class="data-table-container">
                        <div class="table-controls">
                            <div class="table-search">
                                <span>ðŸ”</span>
                                <input type="text" placeholder="Search sizes..." id="sizeSearch">
                            </div>
                            <div class="table-pagination">
                                <button class="pagination-btn" id="prevPage" onclick="changePage(-1)">â†</button>
                                <span id="pageInfo">Page 1 of 1</span>
                                <button class="pagination-btn" id="nextPage" onclick="changePage(1)">â†’</button>
                            </div>
                        </div>
                        
                        <div style="overflow-x: auto;">
                            <table class="insights-table" id="insightsTable">
                                <thead>
                                    <tr>
                                        <th onclick="sortTable('size')">SIZE <span class="sort-indicator">â†•</span></th>
                                        <th onclick="sortTable('recommendations')">RECOMMENDATIONS <span class="sort-indicator">â†•</span></th>
                                        <th onclick="sortTable('percentage')">PERCENTAGE <span class="sort-indicator">â†•</span></th>
                                        <th onclick="sortTable('avgBust')">AVG BUST <span class="sort-indicator">â†•</span></th>
                                        <th onclick="sortTable('avgWaist')">AVG WAIST <span class="sort-indicator">â†•</span></th>
                                        <th onclick="sortTable('avgHip')">AVG HIP <span class="sort-indicator">â†•</span></th>
                                        <th onclick="sortTable('priority')">PRODUCTION PRIORITY <span class="sort-indicator">â†•</span></th>
                                    </tr>
                                </thead>
                                <tbody id="insightsTableBody">
                                    <!-- Dynamic content will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Recommendations Section -->
                <div class="card">
                    <h2 style="color: #1e3a8a; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 8px;">
                        ðŸ’¡ AI-Powered Recommendations
                    </h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                        <!-- Top Performers Card -->
                        <div class="recommendation-card top-performers" id="topPerformersCard">
                            <div class="recommendation-header">TOP PERFORMERS</div>
                            <div class="recommendation-metric" id="topPerformersMetric">-</div>
                            <div class="recommendation-description">of all recommendations</div>
                            <div class="recommendation-focus" id="topPerformersFocus">
                                <strong>Focus Production On:</strong>
                                <ul id="topPerformersList">
                                    <!-- Dynamic content -->
                                </ul>
                            </div>
                        </div>

                        <!-- High Demand Card -->
                        <div class="recommendation-card high-demand" id="highDemandCard">
                            <div class="recommendation-header">HIGH DEMAND</div>
                            <div class="recommendation-metric" id="highDemandMetric">-</div>
                            <div class="recommendation-description">sizes(s) with 50%+ demand</div>
                            <div class="recommendation-focus" id="highDemandFocus">
                                <strong>Increase Stock:</strong>
                                <ul id="highDemandList">
                                    <!-- Dynamic content -->
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Data-Driven Insights -->
                    <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                        <h3 style="color: #1e3a8a; margin-bottom: 1rem;">ðŸ“Š Data-Driven Insights</h3>
                        <div id="dataInsights">
                            <!-- Dynamic insights will be loaded here -->
                        </div>
                    </div>

                    <!-- Recommended Actions -->
                    <div style="background: #f0fdf4; padding: 1.5rem; border-radius: 12px; border-left: 4px solid #22c55e; margin-bottom: 1.5rem;">
                        <h3 style="color: #166534; margin-bottom: 1rem;">âœ… Recommended Actions</h3>
                        <ul id="recommendedActions" style="color: #166534; margin-left: 1rem;">
                            <!-- Dynamic actions will be loaded here -->
                        </ul>
                    </div>

                    <!-- Data Confidence Footer -->
                    <div style="background: #fef2f2; padding: 1rem; border-radius: 8px; border-left: 4px solid #ef4444;">
                        <div style="color: #dc2626; font-size: 0.875rem;" id="dataConfidence">
                            <strong>Data Confidence: CALCULATING...</strong> - Loading analytics data...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Database Tab -->
            <div id="customers" class="tab-content" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">ðŸ‘¥ Customer Measurement Database</h1>
                    <p class="page-subtitle">View, filter, and export all customer measurement data</p>
                </div>

                <!-- Filters Card -->
                <div class="card">
                    <h2 style="color: #1e3a8a; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 8px;">
                        ðŸ” Filters
                    </h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="form-group">
                            <label class="form-label">Date From</label>
                            <input type="date" class="form-input" id="customerFromDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date To</label>
                            <input type="date" class="form-input" id="customerToDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Month</label>
                            <select class="form-select" id="customerMonth">
                                <option value="">All Months</option>
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Year</label>
                            <select class="form-select" id="customerYear">
                                <option value="">All Years</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Size</label>
                            <select class="form-select" id="customerSize">
                                <option value="">All Sizes</option>
                                <option value="XS">XS</option>
                                <option value="S">S</option>
                                <option value="M">M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                                <option value="XXL">XXL</option>
                            </select>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 0.75rem; justify-content: flex-end; margin-top: 1rem;">
                        <button class="modern-btn secondary-btn" onclick="clearCustomerFilters()">
                            Clear Filters
                        </button>
                        <button class="modern-btn primary-btn" onclick="applyCustomerFilters(this)">
                            ðŸ” Apply Filters
                        </button>
                        <button class="modern-btn primary-btn" onclick="exportCustomerData()">
                            ðŸ“Š Export to Excel
                        </button>
                    </div>
                </div>

                <!-- Customer Measurements Card -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: #1e3a8a; display: flex; align-items: center; gap: 8px;">
                            ðŸ“„ Customer Measurements
                        </h2>
                        <div style="color: #6b7280; font-size: 0.875rem;" id="customerCount">
                            Showing 5 of 5 customers
                        </div>
                    </div>
                    
                    <div style="overflow-x: auto;">
                        <table class="customer-table">
                            <thead>
                                <tr>
                                    <th>DATE</th>
                                    <th>CUSTOMER NAME</th>
                                    <th>EMAIL</th>
                                    <th>MOBILE</th>
                                    <th>ADDRESS</th>
                                    <th>CITY</th>
                                    <th>STATE</th>
                                    <th>COUNTRY</th>
                                    <th>BUST</th>
                                    <th>WAIST</th>
                                    <th>HIP</th>
                                    <th>RECOMMENDED SIZE</th>
                                    <th>ORDER ID</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>2025-10-23</td>
                                    <td><strong>Sarah Johnson</strong></td>
                                    <td>sarah.johnson@email.com</td>
                                    <td>+1-555-0123</td>
                                    <td>123 Main Street</td>
                                    <td>New York</td>
                                    <td>NY</td>
                                    <td>USA</td>
                                    <td>37"</td>
                                    <td>30"</td>
                                    <td>35"</td>
                                    <td><span class="size-badge size-l">L</span></td>
                                    <td>6156246286380</td>
                                </tr>
                                <tr>
                                    <td>2025-10-23</td>
                                    <td><strong>Emily Davis</strong></td>
                                    <td>emily.davis@email.com</td>
                                    <td>+1-555-0456</td>
                                    <td>456 Oak Avenue</td>
                                    <td>Los Angeles</td>
                                    <td>CA</td>
                                    <td>USA</td>
                                    <td>35"</td>
                                    <td>25"</td>
                                    <td>35"</td>
                                    <td><span class="size-badge size-m">M</span></td>
                                    <td>6156248383532</td>
                                </tr>
                                <tr>
                                    <td>2025-10-23</td>
                                    <td><strong>Jessica Wilson</strong></td>
                                    <td>jessica.wilson@email.com</td>
                                    <td>+1-555-0789</td>
                                    <td>789 Pine Road</td>
                                    <td>Chicago</td>
                                    <td>IL</td>
                                    <td>USA</td>
                                    <td>33"</td>
                                    <td>20"</td>
                                    <td>31"</td>
                                    <td><span class="size-badge size-s">S</span></td>
                                    <td>6156248383533</td>
                                </tr>
                                <tr>
                                    <td>2025-10-22</td>
                                    <td><strong>Amanda Brown</strong></td>
                                    <td>amanda.brown@email.com</td>
                                    <td>+1-555-0321</td>
                                    <td>321 Elm Street</td>
                                    <td>Houston</td>
                                    <td>TX</td>
                                    <td>USA</td>
                                    <td>39"</td>
                                    <td>32"</td>
                                    <td>38"</td>
                                    <td><span class="size-badge size-xl">XL</span></td>
                                    <td>6156248383534</td>
                                </tr>
                                <tr>
                                    <td>2025-10-22</td>
                                    <td><strong>Michelle Taylor</strong></td>
                                    <td>michelle.taylor@email.com</td>
                                    <td>+1-555-0654</td>
                                    <td>654 Maple Drive</td>
                                    <td>Phoenix</td>
                                    <td>AZ</td>
                                    <td>USA</td>
                                    <td>34"</td>
                                    <td>26"</td>
                                    <td>36"</td>
                                    <td><span class="size-badge size-m">M</span></td>
                                    <td>6156248383535</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Size Chart Tab -->
            <div id="sizechart" class="tab-content" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">ðŸ“ Size Chart Management</h1>
                    <p class="page-subtitle">Create, edit, and manage your size chart</p>
                </div>

                <!-- Unit Selection -->
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <label style="font-weight: 500; color: #374151;">Unit:</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="unit-toggle-btn active" id="inchesBtn" onclick="setUnit('inches')">
                                Inches
                            </button>
                            <button class="unit-toggle-btn" id="cmBtn" onclick="setUnit('cm')">
                                CM
                            </button>
                        </div>
                        <span style="font-size: 0.875rem; color: #6b7280;" id="unitStatus">
                            Auto-detected (Inches)
                        </span>
                    </div>
                    
                    <div style="background: #dbeafe; padding: 1rem; border-radius: 8px; border-left: 4px solid #3b82f6;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; color: #1e40af;">
                            <span>â„¹ï¸</span>
                            <span style="font-size: 0.875rem;">
                                Changes to your size chart will be reflected in the measurement form on your product pages. 
                                All existing customer measurements will be automatically converted and matched regardless of the unit they use.
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Current Size Chart -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: #1e3a8a; display: flex; align-items: center; gap: 8px;">
                            ðŸ“ Current Size Chart
                        </h2>
                        <div style="display: flex; gap: 0.75rem;">
                            <button class="modern-btn primary-btn" onclick="addSizeRow()">
                                âž• Add Size
                            </button>
                            <button class="modern-btn primary-btn" onclick="saveSizeChart()">
                                ðŸ’¾ Save Changes
                            </button>
                        </div>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="size-chart-table" id="sizeChartTable">
                            <thead>
                                <tr>
                                    <th>Size</th>
                                    <th id="bustHeader">Bust (inches)</th>
                                    <th id="waistHeader">Waist (inches)</th>
                                    <th id="hipHeader">Hip (inches)</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="sizeChartBody">
                                <!-- Dynamic rows will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>


            </div>
            
            <!-- Billing Tab -->
            <div id="billing" class="tab-content" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">ðŸ’° Billing Overview</h1>
                    <p class="page-subtitle">Current month's usage and available plans</p>
                </div>

                <!-- Currency Selection -->
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <label style="font-weight: 500; color: #374151;">Currency:</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="currency-toggle-btn active" id="usdBtn" onclick="setCurrency('USD')">
                                ðŸ’µ USD
                            </button>
                            <button class="currency-toggle-btn" id="inrBtn" onclick="setCurrency('INR')">
                                ðŸ’° INR
                            </button>
                        </div>
                        <span style="font-size: 0.875rem; color: #6b7280;" id="currencyStatus">
                            Auto-detected (USD)
                        </span>
                    </div>
                    
                    <div style="background: #dcfce7; padding: 1rem; border-radius: 8px; border-left: 4px solid #22c55e;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; color: #166534;">
                            <span>â„¹ï¸</span>
                            <span style="font-size: 0.875rem;">
                                Currency is automatically detected based on your region. Indian users see INR, others see USD.
                            </span>
                        </div>
                    </div>
                <!-- This Month's Summary -->
                <div class="card">
                    <h2 style="color: #1e3a8a; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 8px;">
                        ðŸ’° This Month's Summary
                    </h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">ðŸ“¦</div>
                            <div class="stat-number" id="ordersWithMeasurements">0</div>
                            <div class="stat-label">Orders with Measurements</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ðŸ·ï¸</div>
                            <div class="stat-number" id="currentPhase">Starter</div>
                            <div class="stat-label">Current Phase</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ðŸ’µ</div>
                            <div class="stat-number" id="ratePerOrder">$0.12</div>
                            <div class="stat-label">Rate Per Order</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ðŸ“Š</div>
                            <div class="stat-number" id="estimatedCharge">$0.00</div>
                            <div class="stat-label">Estimated Charge</div>
                        </div>
                    </div>
                    
                    <!-- Usage Progress Bar -->
                    <div style="margin-top: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 500; color: #374151;">Monthly Usage Progress</span>
                            <span style="font-size: 0.875rem; color: #6b7280;" id="usageProgressText">0 / 500 orders</span>
                        </div>
                        <div style="background: #e5e7eb; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="usageProgressBar" style="background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280;" id="usageStatus">
                            You're using 0% of your monthly allowance
                        </div>
                    </div>
                </div>

                <!-- Billing Phases & Features -->
                <div class="card">
                    <h2 style="color: #1e3a8a; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 8px;">
                        ðŸ“„ Billing Phases & Features
                    </h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <!-- Starter Phase -->
                        <div class="billing-plan-card" id="starterPlan">
                            <div class="plan-header">
                                <div class="plan-icon">ðŸŒ±</div>
                                <div class="plan-title">Starter Phase</div>
                                <div class="plan-subtitle">Perfect for growing stores</div>
                            </div>
                            <div class="plan-price" id="starterPrice">$0.12 per order</div>
                            <div class="plan-volume">1-500 orders/month</div>
                            <div class="plan-features">
                                <div class="feature-item">âœ… Customer measurement form on product pages</div>
                                <div class="feature-item">âœ… Instant size recommendations</div>
                                <div class="feature-item">âœ… Measurements saved to orders</div>
                                <div class="feature-item">âœ… Customizable size charts</div>
                                <div class="feature-item">âœ… Basic analytics dashboard</div>
                                <div class="feature-item">âœ… Customer database export</div>
                                <div class="feature-item">âœ… "Powered by codizzy" branding</div>
                            </div>
                            <button class="plan-button" onclick="selectPlan('starter')" id="starterButton">
                                Current Plan
                            </button>
                        </div>

                        <!-- Professional Phase -->
                        <div class="billing-plan-card professional" id="professionalPlan">
                            <div class="plan-header">
                                <div class="plan-icon">ðŸš€</div>
                                <div class="plan-title">Professional Phase</div>
                                <div class="plan-subtitle">Best value for established stores</div>
                            </div>
                            <div class="plan-price" id="professionalPrice">$0.09 per order</div>
                            <div class="plan-volume">501-1,500 orders/month</div>
                            <div class="plan-features">
                                <div class="feature-section">All Starter Features, Plus:</div>
                                <div class="feature-item">âœ… Advanced analytics & insights</div>
                                <div class="feature-item">âœ… Size distribution charts</div>
                                <div class="feature-item">âœ… Production recommendations</div>
                                <div class="feature-item">âœ… Customer filtering by date/size</div>
                                <div class="feature-item">âœ… Priority email support</div>
                                <div class="feature-item">âœ… Custom branding options</div>
                                <div class="feature-item">âœ… Monthly reports & trends</div>
                            </div>
                            <button class="plan-button professional" onclick="selectPlan('professional')" id="professionalButton">
                                Upgrade to Professional
                            </button>
                        </div>

                        <!-- Enterprise Phase -->
                        <div class="billing-plan-card" id="enterprisePlan">
                            <div class="plan-header">
                                <div class="plan-icon">ðŸ¢</div>
                                <div class="plan-title">Enterprise Phase</div>
                                <div class="plan-subtitle">Maximum value for high-volume stores</div>
                            </div>
                            <div class="plan-price" id="enterprisePrice">$0.06 per order</div>
                            <div class="plan-volume">1,501+ orders/month</div>
                            <div class="plan-features">
                                <div class="feature-section">All Professional Features, Plus:</div>
                                <div class="feature-item">âœ… Unlimited size charts</div>
                                <div class="feature-item">âœ… Advanced data export (CSV/Excel)</div>
                                <div class="feature-item">âœ… API access for integrations</div>
                                <div class="feature-item">âœ… Custom measurement fields</div>
                                <div class="feature-item">âœ… Dedicated account manager</div>
                                <div class="feature-item">âœ… White-label options</div>
                                <div class="feature-item">âœ… 24/7 priority support</div>
                                <div class="feature-item">âœ… Custom features on request</div>
                            </div>
                            <button class="plan-button" onclick="selectPlan('enterprise')" id="enterpriseButton">
                                Upgrade to Enterprise
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Third-Party Payment Integration -->
                <div class="card">
                    <h2 style="color: #1e3a8a; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 8px;">
                        ðŸ’³ Payment Integration
                    </h2>
                    
                    <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 2rem;">ðŸ”—</div>
                            <div>
                                <div style="font-weight: 600; color: #1e3a8a; font-size: 1.1rem;">Third-Party Payment Processing</div>
                                <div style="font-size: 0.875rem; color: #6b7280;">Secure payment processing powered by industry leaders</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                            <div style="background: white; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb; text-align: center;">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">ðŸ’³</div>
                                <div style="font-weight: 600; color: #1e3a8a;">Stripe</div>
                                <div style="font-size: 0.875rem; color: #6b7280;">Global payments</div>
                            </div>
                            
                            <div style="background: white; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb; text-align: center;">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">ðŸ¦</div>
                                <div style="font-weight: 600; color: #1e3a8a;">Razorpay</div>
                                <div style="font-size: 0.875rem; color: #6b7280;">Indian payments</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 1rem; padding: 1rem; background: #dbeafe; border-radius: 8px; border-left: 4px solid #3b82f6;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; color: #1e40af;">
                                <span>â„¹ï¸</span>
                                <span style="font-size: 0.875rem;">
                                    All payments are processed securely through our integrated payment partners. 
                                    No payment information is stored on our servers.
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dynamic Analytics System
        class DynamicAnalytics {
            constructor() {
                this.apiBaseUrl = window.location.hostname === 'localhost' 
                    ? 'http://localhost:3001/api' 
                    : 'https://ideal-fit-app1.onrender.com/api';
                this.refreshInterval = 30000; // 30 seconds
                this.autoRefreshEnabled = true;
                this.refreshTimer = null;
                this.chart = null;
                this.currentData = null;
                this.previousData = null;
                this.sortColumn = null;
                this.sortDirection = 'asc';
                this.currentPage = 1;
                this.itemsPerPage = 10;
                this.searchTerm = '';
                
                this.initializeCharts();
                this.setupEventListeners();
                this.startAutoRefresh();
            }

            // Initialize Chart.js
            initializeCharts() {
                const ctx = document.getElementById('sizeDistributionChart');
                if (!ctx) return;

                this.chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#667eea',
                                '#764ba2',
                                '#f093fb',
                                '#f5576c',
                                '#4facfe',
                                '#00f2fe'
                            ],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        animation: {
                            animateRotate: true,
                            duration: 1000
                        }
                    }
                });
            }

            // Setup event listeners
            setupEventListeners() {
                // Auto-refresh toggle
                const autoRefreshCheckbox = document.getElementById('autoRefresh');
                if (autoRefreshCheckbox) {
                    autoRefreshCheckbox.addEventListener('change', (e) => {
                        this.autoRefreshEnabled = e.target.checked;
                        if (this.autoRefreshEnabled) {
                            this.startAutoRefresh();
                        } else {
                            this.stopAutoRefresh();
                        }
                    });
                }

                // Chart period selector
                const chartPeriod = document.getElementById('chartPeriod');
                if (chartPeriod) {
                    chartPeriod.addEventListener('change', (e) => {
                        this.loadAnalyticsData();
                    });
                }

                // Search functionality
                const sizeSearch = document.getElementById('sizeSearch');
                if (sizeSearch) {
                    sizeSearch.addEventListener('input', (e) => {
                        this.searchTerm = e.target.value.toLowerCase();
                        this.updateInsightsTable();
                    });
                }

                // Filter change listeners
                ['analyticsFromDate', 'analyticsToDate', 'analyticsMonth', 'analyticsYear'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('change', () => {
                            this.updateActiveFilters();
                        });
                    }
                });
            }

            // Start auto-refresh
            startAutoRefresh() {
                if (this.refreshTimer) {
                    clearInterval(this.refreshTimer);
                }
                
                if (this.autoRefreshEnabled) {
                    this.refreshTimer = setInterval(() => {
                        this.loadAnalyticsData();
                        this.updateRefreshTimer();
                    }, this.refreshInterval);
                    
                    this.updateRefreshTimer();
                }
            }

            // Stop auto-refresh
            stopAutoRefresh() {
                if (this.refreshTimer) {
                    clearInterval(this.refreshTimer);
                    this.refreshTimer = null;
                }
                document.getElementById('refreshInterval').textContent = 'Auto-refresh disabled';
            }

            // Update refresh timer display
            updateRefreshTimer() {
                const refreshInterval = document.getElementById('refreshInterval');
                if (refreshInterval) {
                    refreshInterval.textContent = `Next update in ${this.refreshInterval / 1000}s`;
                }
            }

            // Load analytics data from API
            async loadAnalyticsData() {
                try {
                    this.showLoadingState();
                    
                    // Store previous data for trend calculation
                    this.previousData = this.currentData;
                    
                    // Simulate API call - replace with actual API endpoint
                    const data = await this.fetchAnalyticsData();
                    
                    this.currentData = data;
                    this.updateKPICards(data);
                    this.updateChart(data);
                    this.updateInsightsTable(data);
                    this.updateRecommendations(data);
                    this.updateDataInsights(data);
                    this.updateDataConfidence(data);
                    
                    this.hideLoadingState();
                    
                    // Add notification
                    dashboardState.addMajorNotification('success', 'Analytics data updated', 'ðŸ“Š');
                    
                } catch (error) {
                    console.error('Error loading analytics data:', error);
                    this.showErrorState();
                    dashboardState.addMajorNotification('error', 'Failed to load analytics data', 'âŒ');
                }
            }

            // Fetch analytics data from Shopify REST API
            async fetchAnalyticsData() {
                try {
                    // Try Shopify REST API first
                    const response = await fetch(`${this.apiBaseUrl}/shopify-rest-analytics?period=30d`);
                    if (response.ok) {
                        const apiData = await response.json();
                        if (apiData.success) {
                            if (apiData.fallback) {
                                console.log('âš ï¸ Using fallback analytics data:', apiData.message);
                            } else {
                                console.log('âœ… Using Shopify REST API analytics data');
                            }
                            return this.transformShopifyAnalyticsData(apiData.data);
                        }
                    }
                    
                    // Fallback to local analytics API
                    console.log('âš ï¸ Shopify REST API unavailable, using local analytics');
                    const localResponse = await fetch(`${this.apiBaseUrl}/analytics?shop=idealfit-2.myshopify.com`);
                    if (localResponse.ok) {
                        const localData = await localResponse.json();
                        if (localData.success) {
                            return this.transformLocalAnalyticsData(localData.data);
                        }
                    }
                    
                    throw new Error('Both Shopify REST and local APIs failed');
                    
                } catch (error) {
                    console.error('Error fetching analytics data:', error);
                    // Fallback to mock data
                    return this.generateMockData();
                }
            }
            
            // Transform Shopify analytics data to dashboard format
            transformShopifyAnalyticsData(data) {
                console.log('ðŸ“Š Transforming Shopify analytics data:', data);
                return {
                    summary: {
                        totalOrders: data.summary.totalOrders,
                        uniqueCustomers: data.summary.uniqueCustomers,
                        totalRevenue: data.summary.totalRevenue,
                        averageOrderValue: data.summary.averageOrderValue
                    },
                    sizeData: data.sizeDistribution || [],
                    topPerformers: data.topCustomers.slice(0, 2).map(customer => ({
                        name: customer.name,
                        orders: customer.totalOrders
                    })),
                    highDemand: data.sizeDistribution ? data.sizeDistribution.filter(item => item.recommendations > 1).map(item => item.size) : [],
                    recentActivity: data.recentActivity
                };
            }
            
            // Transform local analytics data to dashboard format
            transformLocalAnalyticsData(data) {
                return {
                    summary: {
                        totalOrders: data.summary.totalOrders,
                        uniqueCustomers: data.summary.uniqueCustomers,
                        totalRevenue: data.summary.totalRevenue,
                        averageOrderValue: data.summary.averageOrderValue
                    },
                    sizeData: data.sizeDistribution || [],
                    topPerformers: data.topCustomers.slice(0, 2).map(customer => ({
                        name: customer.name,
                        orders: customer.totalOrders
                    })),
                    highDemand: data.sizeDistribution ? data.sizeDistribution.filter(item => item.recommendations > 1).map(item => item.size) : [],
                    recentActivity: data.recentActivity
                };
            }
            
            // Generate mock data as fallback
            generateMockData() {
                const sizes = ['XS', 'S', 'M', 'L', 'XL', 'XXL'];
                const sizeData = sizes.map(size => ({
                    size,
                    recommendations: Math.floor(Math.random() * 50) + 10,
                    percentage: 0,
                    avgBust: (Math.random() * 10 + 30).toFixed(1),
                    avgWaist: (Math.random() * 10 + 25).toFixed(1),
                    avgHip: (Math.random() * 10 + 30).toFixed(1),
                    priority: Math.random() > 0.5 ? 'HIGH' : 'MEDIUM'
                }));
                
                const total = sizeData.reduce((sum, item) => sum + item.recommendations, 0);
                sizeData.forEach(item => {
                    item.percentage = total > 0 ? ((item.recommendations / total) * 100).toFixed(1) : '0.0';
                });
                
                return {
                    summary: {
                        totalOrders: 3,
                        uniqueCustomers: 3,
                        totalRevenue: 299.97,
                        averageOrderValue: 99.99
                    },
                    sizeData,
                    topPerformers: [
                        { name: 'Sarah Johnson', orders: 1 },
                        { name: 'Emily Davis', orders: 1 }
                    ],
                    highDemand: ['L', 'M'],
                    recentActivity: { orders: 3, revenue: 299.97 }
                };
            }

            // Update KPI cards with animations
            updateKPICards(data) {
                const summary = data.summary;
                
                // Animate KPI updates
                this.animateKPIUpdate('totalOrders', summary.totalOrders);
                this.animateKPIUpdate('uniqueCustomers', summary.uniqueCustomers);
                this.animateKPIUpdate('mostPopularSize', data.sizeData[0]?.size || 'L');
                this.animateKPIUpdate('returnReduction', '32%'); // Default value
                
                // Update trends
                this.updateTrends(data);
            }

            // Animate KPI value update
            animateKPIUpdate(elementId, newValue) {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                element.style.transform = 'scale(1.1)';
                element.style.color = '#3b82f6';
                
                setTimeout(() => {
                    element.textContent = newValue;
                    element.style.transform = 'scale(1)';
                    element.style.color = '#1e3a8a';
                }, 200);
            }

            // Update trend indicators
            updateTrends(data) {
                if (!this.previousData) return;
                
                const trends = {
                    totalOrders: this.calculateTrend(this.previousData.kpis.totalOrders, data.kpis.totalOrders),
                    uniqueCustomers: this.calculateTrend(this.previousData.kpis.uniqueCustomers, data.kpis.uniqueCustomers),
                    returnReduction: this.calculateTrend(parseFloat(this.previousData.kpis.returnReduction), parseFloat(data.kpis.returnReduction))
                };
                
                Object.entries(trends).forEach(([key, trend]) => {
                    this.updateTrendIndicator(key, trend);
                });
            }

            // Calculate trend direction and percentage
            calculateTrend(oldValue, newValue) {
                const change = newValue - oldValue;
                const percentage = oldValue > 0 ? ((change / oldValue) * 100).toFixed(1) : 0;
                
                if (change > 0) return { direction: 'up', percentage: Math.abs(percentage) };
                if (change < 0) return { direction: 'down', percentage: Math.abs(percentage) };
                return { direction: 'neutral', percentage: 0 };
            }

            // Update trend indicator
            updateTrendIndicator(elementId, trend) {
                const trendElement = document.getElementById(elementId + 'Trend');
                if (!trendElement) return;
                
                const icons = {
                    up: 'â†—',
                    down: 'â†˜',
                    neutral: 'â†”'
                };
                
                const classes = {
                    up: 'trend-up',
                    down: 'trend-down',
                    neutral: 'trend-neutral'
                };
                
                trendElement.innerHTML = `
                    <span class="${classes[trend.direction]}">
                        ${icons[trend.direction]} ${trend.percentage}% ${trend.direction === 'neutral' ? 'No change' : trend.direction}
                    </span>
                `;
            }

            // Update chart with new data
            updateChart(data) {
                if (!this.chart) return;
                
                // Handle both API data structure and fallback data structure
                const chartData = data.sizeData || data.sizeDistribution || [];
                const chartDataSlice = chartData.slice(0, 6); // Top 6 sizes
                
                this.chart.data.labels = chartDataSlice.map(item => `Size ${item.size}`);
                this.chart.data.datasets[0].data = chartDataSlice.map(item => item.recommendations);
                
                this.chart.update('active');
            }

            // Update insights table
            updateInsightsTable(data) {
                const tbody = document.getElementById('insightsTableBody');
                if (!tbody) return;
                
                // Handle both API data structure and fallback data structure
                let filteredData = data.sizeData || data.sizeDistribution || [];
                
                // Apply search filter
                if (this.searchTerm) {
                    filteredData = filteredData.filter(item => 
                        item.size.toLowerCase().includes(this.searchTerm)
                    );
                }
                
                // Apply sorting
                if (this.sortColumn) {
                    filteredData.sort((a, b) => {
                        let aVal = a[this.sortColumn];
                        let bVal = b[this.sortColumn];
                        
                        if (this.sortColumn === 'percentage') {
                            aVal = parseFloat(aVal);
                            bVal = parseFloat(bVal);
                        }
                        
                        if (this.sortDirection === 'asc') {
                            return aVal > bVal ? 1 : -1;
                        } else {
                            return aVal < bVal ? 1 : -1;
                        }
                    });
                }
                
                // Apply pagination
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const paginatedData = filteredData.slice(startIndex, endIndex);
                
                // Update table body
                tbody.innerHTML = paginatedData.map(item => `
                    <tr>
                        <td><strong>${item.size}</strong></td>
                        <td>${item.recommendations}</td>
                        <td>${item.percentage}%</td>
                        <td>${item.avgBust}"</td>
                        <td>${item.avgWaist}"</td>
                        <td>${item.avgHip}"</td>
                        <td><span class="priority-badge ${item.priority.toLowerCase()}">${item.priority}</span></td>
                    </tr>
                `).join('');
                
                // Update pagination info
                this.updatePaginationInfo(filteredData.length);
            }

            // Update pagination info
            updatePaginationInfo(totalItems) {
                const totalPages = Math.ceil(totalItems / this.itemsPerPage);
                const pageInfo = document.getElementById('pageInfo');
                const prevBtn = document.getElementById('prevPage');
                const nextBtn = document.getElementById('nextPage');
                
                if (pageInfo) {
                    pageInfo.textContent = `Page ${this.currentPage} of ${totalPages}`;
                }
                
                if (prevBtn) {
                    prevBtn.disabled = this.currentPage <= 1;
                }
                
                if (nextBtn) {
                    nextBtn.disabled = this.currentPage >= totalPages;
                }
            }

            // Update recommendations
            updateRecommendations(data) {
                // Handle both API data structure and fallback data structure
                const insights = data.insights || {};
                const sizeData = data.sizeData || data.sizeDistribution || [];
                
                // Update top performers
                const topPerformersMetric = document.getElementById('topPerformersMetric');
                const topPerformersList = document.getElementById('topPerformersList');
                
                if (topPerformersMetric) {
                    const topPerformers = insights.topPerformers || sizeData.slice(0, 2);
                    const topPercentage = topPerformers.reduce((sum, item) => sum + parseFloat(item.percentage || 0), 0);
                    topPerformersMetric.textContent = topPercentage.toFixed(1) + '%';
                }
                
                if (topPerformersList) {
                    const topPerformers = insights.topPerformers || sizeData.slice(0, 2);
                    topPerformersList.innerHTML = topPerformers.map(item => 
                        `<li>Size ${item.size} (${item.recommendations || 0} orders)</li>`
                    ).join('');
                }
                
                // Update high demand
                const highDemandMetric = document.getElementById('highDemandMetric');
                const highDemandList = document.getElementById('highDemandList');
                
                if (highDemandMetric) {
                    const highDemand = insights.highDemand || data.highDemand || [];
                    highDemandMetric.textContent = highDemand.length;
                }
                
                if (highDemandList) {
                    const highDemand = insights.highDemand || data.highDemand || [];
                    highDemandList.innerHTML = highDemand.map(item => 
                        `<li><input type="checkbox" checked> Size ${item.size || item} - ${item.percentage || '0'}%</li>`
                    ).join('');
                }
            }

            // Update data insights
            updateDataInsights(data) {
                const insights = data.insights || {};
                const sizeData = data.sizeData || data.sizeDistribution || [];
                const dataInsights = document.getElementById('dataInsights');
                
                if (dataInsights && sizeData.length > 0) {
                    const topSize = sizeData[0];
                    dataInsights.innerHTML = `
                        <div style="margin-bottom: 1rem;">
                            <strong>Primary Focus:</strong> Size ${topSize.size} represents your top market (${topSize.percentage}% of demand)
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Customer Profile:</strong>
                            <ul style="margin-left: 1rem; margin-top: 0.5rem;">
                                ${sizeData.slice(0, 3).map(item => 
                                    `<li>Size ${item.size}: Bust ${item.avgBust}", Waist ${item.avgWaist}", Hip ${item.avgHip}"</li>`
                                ).join('')}
                            </ul>
                        </div>
                        <div>
                            <strong>Market Coverage:</strong> Your current size range covers ${insights.totalMeasurements || '100.0'} customer measurements
                        </div>
                    `;
                }
            }

            // Update data confidence
            updateDataConfidence(data) {
                const insights = data.insights || {};
                const sizeData = data.sizeData || data.sizeDistribution || [];
                const dataConfidence = document.getElementById('dataConfidence');
                
                if (dataConfidence) {
                    const totalMeasurements = insights.totalMeasurements || sizeData.reduce((sum, item) => sum + (item.recommendations || 0), 0);
                    const confidenceLevel = insights.dataConfidence || (totalMeasurements > 100 ? 'HIGH' : totalMeasurements > 50 ? 'MEDIUM' : 'LOW');
                    
                    const confidenceColors = {
                        HIGH: '#22c55e',
                        MEDIUM: '#f59e0b',
                        LOW: '#ef4444'
                    };
                    
                    dataConfidence.innerHTML = `
                        <strong>Data Confidence: ${confidenceLevel}</strong> - 
                        ${totalMeasurements} measurements collected - 
                        ${confidenceLevel === 'HIGH' ? 'insights are reliable' : 
                          confidenceLevel === 'MEDIUM' ? 'insights are improving' : 
                          'collect more data for better insights'}
                    `;
                    
                    dataConfidence.style.color = confidenceColors[confidenceLevel];
                }
            }

            // Update active filters display
            updateActiveFilters() {
                const activeFilters = document.getElementById('activeFilters');
                if (!activeFilters) return;
                
                const filters = [];
                
                const fromDate = document.getElementById('analyticsFromDate')?.value;
                const toDate = document.getElementById('analyticsToDate')?.value;
                const month = document.getElementById('analyticsMonth')?.value;
                const year = document.getElementById('analyticsYear')?.value;
                
                if (fromDate) filters.push({ key: 'fromDate', label: `From: ${fromDate}`, value: fromDate });
                if (toDate) filters.push({ key: 'toDate', label: `To: ${toDate}`, value: toDate });
                if (month) filters.push({ key: 'month', label: `Month: ${month}`, value: month });
                if (year) filters.push({ key: 'year', label: `Year: ${year}`, value: year });
                
                activeFilters.innerHTML = filters.map(filter => `
                    <div class="filter-tag active">
                        ${filter.label}
                        <span class="remove" onclick="removeFilter('${filter.key}')">Ã—</span>
                    </div>
                `).join('');
            }

            // Show loading state
            showLoadingState() {
                const cards = document.querySelectorAll('.stat-card.dynamic');
                cards.forEach(card => card.classList.add('updating'));
                
                const chartLoading = document.getElementById('chartLoading');
                if (chartLoading) {
                    chartLoading.classList.remove('hidden');
                }
            }

            // Hide loading state
            hideLoadingState() {
                const cards = document.querySelectorAll('.stat-card.dynamic');
                cards.forEach(card => card.classList.remove('updating'));
                
                const chartLoading = document.getElementById('chartLoading');
                if (chartLoading) {
                    chartLoading.classList.add('hidden');
                }
            }

            // Show error state
            showErrorState() {
                const cards = document.querySelectorAll('.stat-card.dynamic');
                cards.forEach(card => card.classList.add('error'));
                
                setTimeout(() => {
                    cards.forEach(card => card.classList.remove('error'));
                }, 3000);
            }
        }

        // Size Chart Management System
        class SizeChartManager {
            constructor() {
                this.currentUnit = 'inches';
                this.sizeChart = [];
                this.nextId = 1;
                this.initializeSizeChart();
                this.loadSizeChart(); // This is now async
            }

            initializeSizeChart() {
                // Default size chart data
                this.sizeChart = [
                    { id: 1, size: 'XS', bust: 30, waist: 25, hip: 35 },
                    { id: 2, size: 'S', bust: 32, waist: 27, hip: 37 },
                    { id: 3, size: 'M', bust: 34, waist: 29, hip: 39 },
                    { id: 4, size: 'L', bust: 36, waist: 31, hip: 41 },
                    { id: 5, size: 'XL', bust: 38, waist: 33, hip: 43 },
                    { id: 6, size: 'XXL', bust: 40, waist: 35, hip: 45 }
                ];
                this.nextId = 7;
            }

            async loadSizeChart() {
                try {
                    console.log('ðŸ”„ Loading size chart from API...');
                    const apiBaseUrl = window.location.hostname === 'localhost' 
                        ? 'http://localhost:3001/api' 
                        : 'https://ideal-fit-app1.onrender.com/api';
                    const response = await fetch(`${apiBaseUrl}/sizecharts?shop=idealfit-2.myshopify.com`);
                    const data = await response.json();
                    
                    if (data && data.success && data.data && data.data.length > 0) {
                        const chartData = data.data[0];
                        if (chartData.sizeChart && Array.isArray(chartData.sizeChart)) {
                            // Convert API data to internal format
                            this.sizeChart = chartData.sizeChart.map((item, index) => ({
                                id: index + 1,
                                size: item.size,
                                bust: item.bust,
                                waist: item.waist,
                                hip: item.hip
                            }));
                            this.nextId = this.sizeChart.length + 1;
                            console.log('âœ… Size chart loaded from API:', this.sizeChart);
                        }
                    } else {
                        console.log('âš ï¸ No size chart found in API, using default');
                    }
                } catch (error) {
                    console.error('âŒ Error loading size chart from API:', error);
                    console.log('Using default size chart');
                }
                
                this.renderSizeChart();
            }

            setUnit(unit) {
                this.currentUnit = unit;
                
                // Update button states
                document.getElementById('inchesBtn').classList.toggle('active', unit === 'inches');
                document.getElementById('cmBtn').classList.toggle('active', unit === 'cm');
                
                // Update headers
                const unitText = unit === 'inches' ? 'inches' : 'cm';
                document.getElementById('bustHeader').textContent = `Bust (${unitText})`;
                document.getElementById('waistHeader').textContent = `Waist (${unitText})`;
                document.getElementById('hipHeader').textContent = `Hip (${unitText})`;
                
                // Update status
                document.getElementById('unitStatus').textContent = `Auto-detected (${unit === 'inches' ? 'Inches' : 'Centimeters'})`;
                
                // Re-render chart with converted values
                this.renderSizeChart();
                
                // Show notification for major events only
                this.showNotification('success', 'Unit Changed', `Size chart converted to ${unit === 'inches' ? 'inches' : 'centimeters'}`);
            }

            showNotification(type, title, message) {
                try {
                    if (window.showEnhancedNotification) {
                        window.showEnhancedNotification(type, title, message);
                    } else {
                        console.log(`${type.toUpperCase()}: ${title} - ${message}`);
                    }
                } catch (error) {
                    console.error('Error showing notification:', error);
                }
            }

            convertValue(value, fromUnit, toUnit) {
                if (fromUnit === toUnit) return value;
                
                if (fromUnit === 'inches' && toUnit === 'cm') {
                    return Math.round(value * 2.54 * 10) / 10;
                } else if (fromUnit === 'cm' && toUnit === 'inches') {
                    return Math.round(value / 2.54 * 10) / 10;
                }
                
                return value;
            }

            renderSizeChart() {
                const tbody = document.getElementById('sizeChartBody');
                tbody.innerHTML = '';

                this.sizeChart.forEach(item => {
                    const row = document.createElement('tr');
                    
                    // Convert values based on current unit
                    const bust = this.convertValue(item.bust, 'inches', this.currentUnit);
                    const waist = this.convertValue(item.waist, 'inches', this.currentUnit);
                    const hip = this.convertValue(item.hip, 'inches', this.currentUnit);
                    
                    row.innerHTML = `
                        <td>
                            <input type="text" class="size-input" value="${item.size}" 
                                   data-field="size" data-id="${item.id}" 
                                   style="text-align: center; font-weight: 600;">
                        </td>
                        <td>
                            <input type="number" class="size-input" value="${bust}" 
                                   data-field="bust" data-id="${item.id}" 
                                   step="0.1" min="0" max="100">
                        </td>
                        <td>
                            <input type="number" class="size-input" value="${waist}" 
                                   data-field="waist" data-id="${item.id}" 
                                   step="0.1" min="0" max="100">
                        </td>
                        <td>
                            <input type="number" class="size-input" value="${hip}" 
                                   data-field="hip" data-id="${item.id}" 
                                   step="0.1" min="0" max="100">
                        </td>
                        <td>
                            <button class="delete-btn" onclick="sizeChartManager.deleteSize(${item.id})" title="Delete Size">
                                ðŸ—‘ï¸
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });

                // Add event listeners for input changes
                tbody.querySelectorAll('.size-input').forEach(input => {
                    input.addEventListener('input', (e) => {
                        this.updateSizeValue(e.target);
                    });
                });
            }

            updateSizeValue(input) {
                const id = parseInt(input.dataset.id);
                const field = input.dataset.field;
                const value = field === 'size' ? input.value : parseFloat(input.value) || 0;
                
                const item = this.sizeChart.find(item => item.id === id);
                if (item) {
                    if (field === 'size') {
                        item[field] = value;
                    } else {
                        // Convert back to inches for storage
                        const convertedValue = this.convertValue(value, this.currentUnit, 'inches');
                        item[field] = convertedValue;
                    }
                }
            }

            addSizeRow() {
                const newSize = {
                    id: this.nextId++,
                    size: this.getNextSizeLabel(),
                    bust: 36,
                    waist: 31,
                    hip: 41
                };
                
                this.sizeChart.push(newSize);
                this.renderSizeChart();
                
                // Show notification for major events only
                this.showNotification('success', 'Size Added', `New size ${newSize.size} added to chart`);
            }

            getNextSizeLabel() {
                const existingSizes = this.sizeChart.map(item => item.size);
                const sizeOrder = ['XS', 'S', 'M', 'L', 'XL', 'XXL', 'XXXL', 'XXXXL'];
                
                for (const size of sizeOrder) {
                    if (!existingSizes.includes(size)) {
                        return size;
                    }
                }
                
                // If all standard sizes are used, create custom size
                return `Size ${this.sizeChart.length + 1}`;
            }

            deleteSize(id) {
                const item = this.sizeChart.find(item => item.id === id);
                if (item && this.sizeChart.length > 1) {
                    this.sizeChart = this.sizeChart.filter(item => item.id !== id);
                    this.renderSizeChart();
                    
                // Show notification for major events only
                this.showNotification('info', 'Size Deleted', `Size ${item.size} removed from chart`);
                } else {
                    this.showNotification('warning', 'Cannot Delete', 'At least one size must remain in the chart');
                }
            }

            async saveSizeChart() {
                this.showNotification('info', 'Saving...', 'Size chart changes are being saved');
                
                try {
                    // Save to API server
                    const apiBaseUrl = window.location.hostname === 'localhost' 
                        ? 'http://localhost:3001/api' 
                        : 'https://ideal-fit-app1.onrender.com/api';
                    const response = await fetch(`${apiBaseUrl}/sizecharts`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            shop: 'idealfit-2.myshopify.com',
                            sizeChart: this.sizeChart.map(item => ({
                                size: item.size,
                                bust: item.bust,
                                waist: item.waist,
                                hip: item.hip
                            }))
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log('âœ… Size chart saved to API:', data);
                    
                    // Also save to localStorage for persistence
                    localStorage.setItem('sizeChart', JSON.stringify(this.sizeChart));
                    localStorage.setItem('sizeChartUnit', this.currentUnit);
                    
                    this.showNotification('success', 'Saved Successfully', 'Size chart has been updated and synced with product pages');
                } catch (error) {
                    console.error('âŒ Error saving size chart:', error);
                    // Fallback to localStorage only
                    localStorage.setItem('sizeChart', JSON.stringify(this.sizeChart));
                    localStorage.setItem('sizeChartUnit', this.currentUnit);
                    this.showNotification('warning', 'Saved Locally', 'Size chart saved locally, but sync with product pages failed');
                }
            }

            showNotification(type, title, message) {
                const notification = document.createElement('div');
                notification.className = 'notification-toast';
                
                const iconMap = {
                    success: 'âœ…',
                    info: 'â„¹ï¸',
                    warning: 'âš ï¸',
                    error: 'âŒ'
                };
                
                notification.innerHTML = `
                    <div class="notification-toast-header">
                        <div class="notification-toast-icon ${type}">
                            ${iconMap[type]}
                        </div>
                        <div class="notification-toast-content">
                            <h4 class="notification-toast-title">${title}</h4>
                        </div>
                        <button class="notification-toast-close" onclick="this.parentElement.parentElement.remove()">
                            Ã—
                        </button>
                    </div>
                    <div class="notification-toast-body">
                        <p class="notification-toast-message">${message}</p>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Show notification
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);
                
                // Auto-hide after 4 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }, 4000);
            }
        }

        // Dynamic Billing Management System
        class BillingManager {
            constructor() {
                this.currentPlan = 'starter';
                this.monthlyOrders = 0;
                this.billingHistory = [];
                this.refreshInterval = null;
                this.currentCurrency = 'USD';
                this.isIndianRegion = this.detectIndianRegion();
                this.exchangeRate = 83.5; // USD to INR rate (approximate)
                this.initializeBilling();
                this.loadBillingData();
                this.startAutoRefresh();
            }

            detectIndianRegion() {
                // Check timezone, language, or other indicators
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const language = navigator.language;
                
                // Check if timezone indicates India
                if (timezone.includes('Asia/Kolkata') || timezone.includes('Asia/Calcutta')) {
                    return true;
                }
                
                // Check if language indicates India
                if (language.includes('en-IN') || language.includes('hi-IN')) {
                    return true;
                }
                
                // Check if user agent indicates India (basic detection)
                const userAgent = navigator.userAgent;
                if (userAgent.includes('IN') || userAgent.includes('India')) {
                    return true;
                }
                
                // Default to USD for other regions
                return false;
            }

            initializeBilling() {
                // Set default currency based on region detection
                this.currentCurrency = this.isIndianRegion ? 'INR' : 'USD';
                
                // Default billing data
                this.billingHistory = [];
            }

            loadBillingData() {
                this.updateBillingSummary();
                this.updatePlanButtons();
                this.updateCurrencyDisplay();
            }

            convertCurrency(amount, fromCurrency, toCurrency) {
                if (fromCurrency === toCurrency) return amount;
                
                if (fromCurrency === 'USD' && toCurrency === 'INR') {
                    return Math.round(amount * this.exchangeRate * 100) / 100;
                } else if (fromCurrency === 'INR' && toCurrency === 'USD') {
                    return Math.round(amount / this.exchangeRate * 100) / 100;
                }
                
                return amount;
            }

            formatCurrency(amount, currency) {
                if (currency === 'INR') {
                    return `â‚¹${amount.toFixed(2)}`;
                } else {
                    return `$${amount.toFixed(2)}`;
                }
            }

            setCurrency(currency) {
                this.currentCurrency = currency;
                
                // Update button states
                document.getElementById('usdBtn').classList.toggle('active', currency === 'USD');
                document.getElementById('inrBtn').classList.toggle('active', currency === 'INR');
                
                // Update status
                document.getElementById('currencyStatus').textContent = `Auto-detected (${currency})`;
                
                // Re-render billing data with new currency
                this.updateBillingSummary();
                this.updatePlanButtons();
                
                // Show notification for major events only
                this.showNotification('success', 'Currency Changed', `Billing amounts converted to ${currency}`);
            }

            updateCurrencyDisplay() {
                // Set initial currency based on region detection
                this.setCurrency(this.currentCurrency);
            }

            updateBillingSummary() {
                // Simulate dynamic order count
                this.monthlyOrders = Math.floor(Math.random() * 50) + 1;
                
                const planRates = {
                    starter: { rate: 0.12, limit: 500 },
                    professional: { rate: 0.09, limit: 1500 },
                    enterprise: { rate: 0.06, limit: Infinity }
                };
                
                const currentPlanData = planRates[this.currentPlan];
                const estimatedChargeUSD = this.monthlyOrders * currentPlanData.rate;
                const estimatedCharge = this.convertCurrency(estimatedChargeUSD, 'USD', this.currentCurrency);
                const usagePercentage = Math.min((this.monthlyOrders / currentPlanData.limit) * 100, 100);
                
                // Update KPI cards
                document.getElementById('ordersWithMeasurements').textContent = this.monthlyOrders;
                document.getElementById('currentPhase').textContent = this.currentPlan.charAt(0).toUpperCase() + this.currentPlan.slice(1);
                document.getElementById('ratePerOrder').textContent = this.formatCurrency(this.convertCurrency(currentPlanData.rate, 'USD', this.currentCurrency), this.currentCurrency);
                document.getElementById('estimatedCharge').textContent = this.formatCurrency(estimatedCharge, this.currentCurrency);
                
                // Update progress bar
                const progressBar = document.getElementById('usageProgressBar');
                const progressText = document.getElementById('usageProgressText');
                const usageStatus = document.getElementById('usageStatus');
                
                if (this.currentPlan === 'enterprise') {
                    progressText.textContent = `${this.monthlyOrders} orders (unlimited)`;
                    progressBar.style.width = '0%';
                    usageStatus.textContent = 'Enterprise plan has unlimited usage';
                } else {
                    progressText.textContent = `${this.monthlyOrders} / ${currentPlanData.limit} orders`;
                    progressBar.style.width = `${usagePercentage}%`;
                    usageStatus.textContent = `You're using ${usagePercentage.toFixed(1)}% of your monthly allowance`;
                    
                    // Change color based on usage
                    if (usagePercentage > 80) {
                        progressBar.style.background = 'linear-gradient(90deg, #ef4444 0%, #dc2626 100%)';
                    } else if (usagePercentage > 60) {
                        progressBar.style.background = 'linear-gradient(90deg, #f59e0b 0%, #d97706 100%)';
                    } else {
                        progressBar.style.background = 'linear-gradient(90deg, #22c55e 0%, #16a34a 100%)';
                    }
                }
            }

            updatePlanButtons() {
                // Reset all buttons
                document.getElementById('starterButton').textContent = 'Select Plan';
                document.getElementById('professionalButton').textContent = 'Upgrade to Professional';
                document.getElementById('enterpriseButton').textContent = 'Upgrade to Enterprise';
                
                // Update current plan button
                const currentButton = document.getElementById(`${this.currentPlan}Button`);
                currentButton.textContent = 'Current Plan';
                currentButton.style.background = '#22c55e';
                currentButton.style.color = 'white';
                
                // Update plan prices
                this.updatePlanPrices();
            }

            updatePlanPrices() {
                const planRates = {
                    starter: 0.12,
                    professional: 0.09,
                    enterprise: 0.06
                };
                
                // Update each plan price
                Object.keys(planRates).forEach(plan => {
                    const priceElement = document.getElementById(`${plan}Price`);
                    const convertedPrice = this.convertCurrency(planRates[plan], 'USD', this.currentCurrency);
                    priceElement.textContent = `${this.formatCurrency(convertedPrice, this.currentCurrency)} per order`;
                });
            }

            selectPlan(plan) {
                if (plan === this.currentPlan) {
                    showToastNotification('info', 'Current Plan', 'You are already on this plan');
                    return;
                }
                
                const planNames = {
                    starter: 'Starter',
                    professional: 'Professional',
                    enterprise: 'Enterprise'
                };
                
                showToastNotification('info', 'Plan Change', `Upgrading to ${planNames[plan]} plan...`);
                
                setTimeout(() => {
                    this.currentPlan = plan;
                    this.updateBillingSummary();
                    this.updatePlanButtons();
                    // Show notification for major events only
                this.showNotification('success', 'Plan Updated', `Successfully upgraded to ${planNames[plan]} plan`);
                }, 2000);
            }

            startAutoRefresh() {
                this.refreshInterval = setInterval(() => {
                    this.updateBillingSummary();
                }, 30000); // Refresh every 30 seconds
            }

            showNotification(type, title, message) {
                try {
                    if (window.showEnhancedNotification) {
                        window.showEnhancedNotification(type, title, message);
                    } else {
                        console.log(`${type.toUpperCase()}: ${title} - ${message}`);
                    }
                } catch (error) {
                    console.log(`${type.toUpperCase()}: ${title} - ${message}`);
                }
            }

            stopAutoRefresh() {
                if (this.refreshInterval) {
                    clearInterval(this.refreshInterval);
                    this.refreshInterval = null;
                }
            }
        }

        // Global functions for billing
        function selectPlan(plan) {
            if (window.billingManager) {
                window.billingManager.selectPlan(plan);
            }
        }

        function setCurrency(currency) {
            if (window.billingManager) {
                window.billingManager.setCurrency(currency);
            }
        }

        function addSizeRow() {
            if (window.sizeChartManager) {
                window.sizeChartManager.addSizeRow();
            }
        }

        function saveSizeChart() {
            if (window.sizeChartManager) {
                window.sizeChartManager.saveSizeChart();
            }
        }

        // Initialize dynamic analytics
        function initializeDynamicAnalytics() {
            try {
                if (typeof DynamicAnalytics !== 'undefined') {
                    dynamicAnalytics = new DynamicAnalytics();
                    dynamicAnalytics.loadAnalyticsData();
                } else {
                    console.warn('DynamicAnalytics class not available');
                }
            } catch (error) {
                console.error('Error initializing dynamic analytics:', error);
                throw error;
            }
        }

        // Initialize size chart manager
        function initializeSizeChart() {
            try {
                if (typeof SizeChartManager !== 'undefined') {
                    sizeChartManager = new SizeChartManager();
                    window.sizeChartManager = sizeChartManager;
                } else {
                    console.warn('SizeChartManager class not available');
                }
            } catch (error) {
                console.error('Error initializing size chart:', error);
                throw error;
            }
        }

        // Initialize billing manager
        function initializeBilling() {
            try {
                if (typeof BillingManager !== 'undefined') {
                    billingManager = new BillingManager();
                    window.billingManager = billingManager;
                } else {
                    console.warn('BillingManager class not available');
                }
            } catch (error) {
                console.error('Error initializing billing:', error);
                throw error;
            }
        }

        // Refresh analytics data
        function refreshAnalyticsData() {
            if (dynamicAnalytics) {
                dynamicAnalytics.loadAnalyticsData();
            }
        }

        // Sort table
        function sortTable(column) {
            if (dynamicAnalytics) {
                if (dynamicAnalytics.sortColumn === column) {
                    dynamicAnalytics.sortDirection = dynamicAnalytics.sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    dynamicAnalytics.sortColumn = column;
                    dynamicAnalytics.sortDirection = 'asc';
                }
                dynamicAnalytics.updateInsightsTable(dynamicAnalytics.currentData);
            }
        }

        // Change page
        function changePage(direction) {
            if (dynamicAnalytics) {
                dynamicAnalytics.currentPage += direction;
                dynamicAnalytics.updateInsightsTable(dynamicAnalytics.currentData);
            }
        }

        // Remove filter
        function removeFilter(filterKey) {
            const element = document.getElementById('analytics' + filterKey.charAt(0).toUpperCase() + filterKey.slice(1));
            if (element) {
                element.value = '';
                dynamicAnalytics.updateActiveFilters();
                dynamicAnalytics.loadAnalyticsData();
            }
        }

        // Export data with format selection
        function exportData(format) {
            if (!dynamicAnalytics || !dynamicAnalytics.currentData) {
                showError('No data available to export');
                return;
            }
            
            const data = dynamicAnalytics.currentData;
            let content = '';
            let filename = '';
            
            switch (format) {
                case 'csv':
                    content = generateCSV(data);
                    filename = `analytics_data_${new Date().toISOString().split('T')[0]}.csv`;
                    break;
                case 'excel':
                    content = generateExcel(data);
                    filename = `analytics_data_${new Date().toISOString().split('T')[0]}.xlsx`;
                    break;
                case 'pdf':
                    // PDF generation would require a library like jsPDF
                    showError('PDF export not yet implemented');
                    return;
            }
            
            downloadFile(content, filename);
            showSuccess(`Data exported as ${format.toUpperCase()}`);
        }

        // Generate CSV content
        function generateCSV(data) {
            let csv = 'Metric,Value\n';
            
            // Add KPI data
            Object.entries(data.kpis).forEach(([key, value]) => {
                csv += `"${key}","${value}"\n`;
            });
            
            // Add size distribution data
            csv += '\nSize Distribution\n';
            csv += 'Size,Recommendations,Percentage,Avg Bust,Avg Waist,Avg Hip,Priority\n';
            data.sizeDistribution.forEach(item => {
                csv += `"${item.size}","${item.recommendations}","${item.percentage}%","${item.avgBust}","${item.avgWaist}","${item.avgHip}","${item.priority}"\n`;
            });
            
            return csv;
        }

        // Generate Excel content (simplified)
        function generateExcel(data) {
            // This is a simplified version - in production you'd use a library like SheetJS
            return generateCSV(data);
        }

        // Download file
        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
        }

        // Dashboard State Management
        class DashboardState {
            constructor() {
                this.currentTab = 'analytics';
                this.notifications = [
                    {
                        id: 1,
                        type: 'payment',
                        message: 'Payment processed successfully - â‚¹2,999.00 charged',
                        time: '2 minutes ago',
                        icon: 'ðŸ’³',
                        priority: 'major'
                    },
                    {
                        id: 2,
                        type: 'billing',
                        message: 'Invoice generated for October 2024 - INV-2024-001',
                        time: '1 hour ago',
                        icon: 'ðŸ“„',
                        priority: 'major'
                    },
                    {
                        id: 3,
                        type: 'warning',
                        message: 'Plan upgrade required - approaching monthly limit',
                        time: '2 hours ago',
                        icon: 'âš ï¸',
                        priority: 'major'
                    }
                ];
                this.filteredCustomerCount = 5;
                this.totalCustomers = 5;
            }

            // Update notification count
            updateNotificationCount() {
                const countElement = document.getElementById('notificationCount');
                if (countElement) {
                    countElement.textContent = this.notifications.length;
                    countElement.style.display = this.notifications.length > 0 ? 'block' : 'none';
                }
            }

            // Add new notification (major only)
            addNotification(type, message, icon = 'ðŸ””', priority = 'normal') {
                // Only add major notifications
                if (priority !== 'major') {
                    return; // Skip minor notifications
                }
                
                const newNotification = {
                    id: Date.now(),
                    type: type,
                    message: message,
                    time: 'Just now',
                    icon: icon,
                    priority: priority
                };
                
                this.notifications.unshift(newNotification);
                this.updateNotificationCount();
                
                // Show toast notification with specific type
                const notificationTitle = this.getNotificationTitle(type);
                showToastNotification(type, notificationTitle, message);
                
                // Clear notification badge when toast appears
                this.clearNotificationBadge();
            }

            // Get notification title based on type
            getNotificationTitle(type) {
                const titles = {
                    'success': 'âœ… Success',
                    'info': 'â„¹ï¸ Information',
                    'warning': 'âš ï¸ Warning',
                    'error': 'âŒ Error',
                    'payment': 'ðŸ’³ Payment',
                    'sync': 'ðŸ”„ Sync',
                    'shopify': 'ðŸ›ï¸ Shopify',
                    'billing': 'ðŸ’° Billing',
                    'analytics': 'ðŸ“Š Analytics',
                    'customer': 'ðŸ‘¥ Customer',
                    'size': 'ðŸ“ Size Chart',
                    'integration': 'ðŸ”— Integration',
                    'system': 'âš™ï¸ System',
                    'security': 'ðŸ”’ Security',
                    'update': 'ðŸ”„ Update'
                };
                
                return titles[type] || 'ðŸ”” Notification';
            }

            // Clear notification badge
            clearNotificationBadge() {
                const countElement = document.getElementById('notificationCount');
                if (countElement) {
                    countElement.style.display = 'none';
                    countElement.textContent = '0';
                }
            }

            // Add major notification (convenience method)
            addMajorNotification(type, message, icon = 'ðŸ””') {
                this.addNotification(type, message, icon, 'major');
            }

            // Remove notification
            removeNotification(notificationId) {
                this.notifications = this.notifications.filter(n => n.id !== notificationId);
                this.updateNotificationCount();
                loadNotifications();
            }
        }

        // Initialize dashboard state
        const dashboardState = new DashboardState();

        // Tab navigation
        function showTab(tabName) {
            try {
                // Hide all tab contents
                const contents = document.querySelectorAll('.tab-content');
                contents.forEach(content => content.style.display = 'none');
                
                // Remove active class from all nav items
                const navItems = document.querySelectorAll('.tab');
                navItems.forEach(item => item.classList.remove('active'));
                
                // Add active class to clicked item
                const clickedTab = event.target.closest('.tab');
                if (clickedTab) {
                    clickedTab.classList.add('active');
                }
                
                // Show selected content
                const content = document.getElementById(tabName);
                if (content) {
                    content.style.display = 'block';
                    dashboardState.currentTab = tabName;
                    
                    // Save current tab to localStorage for persistence
                    localStorage.setItem('idealfit_current_tab', tabName);
                }
            } catch (error) {
                console.error('Error switching tabs:', error);
                showError('Failed to switch tabs. Please try again.');
            }
        }
        
        // Unit toggle function for size chart
        function setUnit(unit) {
            try {
                if (window.sizeChartManager) {
                    window.sizeChartManager.setUnit(unit);
                } else {
                    console.error('Size chart manager not initialized');
                    showError('Size chart manager not available. Please refresh the page.');
                }
            } catch (error) {
                console.error('Error setting unit:', error);
                showError('Failed to change unit. Please try again.');
            }
        }
        
        // Restore saved tab on page load
        function restoreSavedTab() {
            try {
                const savedTab = localStorage.getItem('idealfit_current_tab');
                if (savedTab) {
                    // Hide all tab contents
                    const contents = document.querySelectorAll('.tab-content');
                    contents.forEach(content => content.style.display = 'none');
                    
                    // Remove active class from all nav items
                    const navItems = document.querySelectorAll('.tab');
                    navItems.forEach(item => item.classList.remove('active'));
                    
                    // Show saved tab content
                    const content = document.getElementById(savedTab);
                    if (content) {
                        content.style.display = 'block';
                        
                        // Add active class to corresponding nav item
                        const navItem = document.querySelector(`[onclick="showTab('${savedTab}')"]`);
                        if (navItem) {
                            navItem.classList.add('active');
                        }
                        
                        dashboardState.currentTab = savedTab;
                        console.log(`Restored tab: ${savedTab}`);
                    }
                }
            } catch (error) {
                console.error('Error restoring saved tab:', error);
            }
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear any stored data
                localStorage.removeItem('idealfit_merchant_auth');
                localStorage.removeItem('idealfit_per_order_billing');
                
                // Redirect to login page or show login form
                alert('Logout successful. Redirecting to login...');
                // In a real app, you would redirect to the login page
                // window.location.href = '/login';
            }
        }

        // Settings function
        function openSettings() {
            const modal = document.getElementById('settingsModal');
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }
        }

        function closeSettings() {
            const modal = document.getElementById('settingsModal');
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = ''; // Restore scrolling
            }
        }

        function showSettingsTab(tabName) {
            // Hide all tab panels
            const panels = document.querySelectorAll('.settings-tab-panel');
            panels.forEach(panel => {
                panel.style.display = 'none';
                panel.classList.remove('active');
            });
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.settings-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab panel
            const selectedPanel = document.getElementById(`settings-${tabName}`);
            if (selectedPanel) {
                selectedPanel.style.display = 'block';
                selectedPanel.classList.add('active');
            }
            
            // Add active class to selected tab
            const selectedTab = document.querySelector(`[onclick="showSettingsTab('${tabName}')"]`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
        }

        function updatePassword() {
            const currentPassword = document.querySelector('#settings-info input[placeholder="Enter current password"]').value;
            const newPassword = document.querySelector('#settings-info input[placeholder="Enter new password"]').value;
            const confirmPassword = document.querySelector('#settings-info input[placeholder="Confirm new password"]').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showToastNotification('error', 'Error', 'Please fill in all password fields');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToastNotification('error', 'Error', 'New passwords do not match');
                return;
            }
            
            if (newPassword.length < 8) {
                showToastNotification('error', 'Error', 'Password must be at least 8 characters long');
                return;
            }
            
            // Simulate password update
            showToastNotification('success', 'Success', 'Password updated successfully');
            
            // Clear password fields
            document.querySelector('#settings-info input[placeholder="Enter current password"]').value = '';
            document.querySelector('#settings-info input[placeholder="Enter new password"]').value = '';
            document.querySelector('#settings-info input[placeholder="Confirm new password"]').value = '';
        }

        function showPaymentOptions() {
            const modal = document.getElementById('paymentOptionsModal');
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }
        }

        function closePaymentOptions() {
            const modal = document.getElementById('paymentOptionsModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = ''; // Restore scrolling
                
                // Reset selection
                const options = document.querySelectorAll('.payment-option');
                options.forEach(option => {
                    option.classList.remove('selected');
                });
                
                const radios = document.querySelectorAll('input[name="paymentMethod"]');
                radios.forEach(radio => {
                    radio.checked = false;
                });
                
                const processBtn = document.getElementById('processPaymentBtn');
                if (processBtn) {
                    processBtn.disabled = true;
                }
            }
        }

        function selectPaymentMethod(method) {
            // Remove selected class from all options
            const options = document.querySelectorAll('.payment-option');
            options.forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            const selectedOption = document.querySelector(`[onclick="selectPaymentMethod('${method}')"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }
            
            // Check the radio button
            const radio = document.getElementById(method);
            if (radio) {
                radio.checked = true;
            }
            
            // Enable proceed button
            const processBtn = document.getElementById('processPaymentBtn');
            if (processBtn) {
                processBtn.disabled = false;
            }
        }

        function processPayment() {
            const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked');
            if (!selectedMethod) {
                showToastNotification('error', 'Error', 'Please select a payment method');
                return;
            }
            
            const method = selectedMethod.value;
            
            if (method === 'razorpay') {
                showToastNotification('info', 'Razorpay', 'Redirecting to Razorpay payment gateway...');
                // TODO: Integrate Razorpay payment
                setTimeout(() => {
                    showToastNotification('success', 'Success', 'Payment processed successfully via Razorpay!');
                    closePaymentOptions();
                }, 2000);
            } else if (method === 'stripe') {
                showToastNotification('info', 'Stripe', 'Redirecting to Stripe payment gateway...');
                // TODO: Integrate Stripe payment
                setTimeout(() => {
                    showToastNotification('success', 'Success', 'Payment processed successfully via Stripe!');
                    closePaymentOptions();
                }, 2000);
            }
        }

        // Close payment modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('paymentOptionsModal');
            if (modal && event.target === modal) {
                closePaymentOptions();
            }
        });

        // Close payment modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('paymentOptionsModal');
                if (modal && modal.style.display === 'flex') {
                    closePaymentOptions();
                }
            }
        });

        function syncShopifyData() {
            showToastNotification('sync', 'ðŸ”„ Syncing', 'Synchronizing data with Shopify store...');
            
            // Simulate sync process
            setTimeout(() => {
                showToastNotification('sync', 'ðŸ”„ Sync Complete', 'Data successfully synchronized with Shopify!');
                
                // Update last sync time
                const lastSyncInput = document.querySelector('#settings-integration input[value="Just now"]');
                if (lastSyncInput) {
                    lastSyncInput.value = 'Just now';
                }
            }, 3000);
        }

        function disconnectShopify() {
            if (confirm('Are you sure you want to disconnect your Shopify store? This will stop all data synchronization.')) {
                showToastNotification('shopify', 'ðŸ›ï¸ Disconnecting', 'Disconnecting from Shopify store...');
                
                // Simulate disconnect process
                setTimeout(() => {
                    // Update status card to disconnected
                    const statusCard = document.querySelector('.status-card.connected');
                    if (statusCard) {
                        statusCard.classList.remove('connected');
                        statusCard.classList.add('disconnected');
                        
                        const statusIcon = statusCard.querySelector('.status-icon');
                        const statusInfo = statusCard.querySelector('.status-info');
                        
                        if (statusIcon) {
                            statusIcon.textContent = 'âŒ';
                        }
                        
                        if (statusInfo) {
                            statusInfo.innerHTML = `
                                <h5>Disconnected from Shopify</h5>
                                <p>Your IdealFit account is no longer connected to your Shopify store</p>
                            `;
                        }
                    }
                    
                    showToastNotification('shopify', 'ðŸ›ï¸ Disconnected', 'Successfully disconnected from Shopify store');
                }, 2000);
            }
        }

        function reconnectShopify() {
            showToastNotification('shopify', 'ðŸ›ï¸ Reconnecting', 'Redirecting to Shopify for reconnection...');
            
            // Simulate redirect to Shopify
            setTimeout(() => {
                // Update status card back to connected
                const statusCard = document.querySelector('.status-card.disconnected');
                if (statusCard) {
                    statusCard.classList.remove('disconnected');
                    statusCard.classList.add('connected');
                    
                    const statusIcon = statusCard.querySelector('.status-icon');
                    const statusInfo = statusCard.querySelector('.status-info');
                    
                    if (statusIcon) {
                        statusIcon.textContent = 'âœ…';
                    }
                    
                    if (statusInfo) {
                        statusInfo.innerHTML = `
                            <h5>Connected to Shopify</h5>
                            <p>Your IdealFit account is successfully integrated with your Shopify store</p>
                        `;
                    }
                }
                
                showToastNotification('shopify', 'ðŸ›ï¸ Reconnected', 'Successfully reconnected to Shopify store!');
            }, 2000);
        }

        // Toggle switch event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const autoSyncToggle = document.getElementById('autoSync');
            const sizeChartSyncToggle = document.getElementById('sizeChartSync');
            const orderTrackingToggle = document.getElementById('orderTracking');
            
            if (autoSyncToggle) {
                autoSyncToggle.addEventListener('change', function() {
                    const status = this.checked ? 'enabled' : 'disabled';
                    showToastNotification('integration', 'ðŸ”— Auto Sync', `Auto sync ${status}`);
                });
            }
            
            if (sizeChartSyncToggle) {
                sizeChartSyncToggle.addEventListener('change', function() {
                    const status = this.checked ? 'enabled' : 'disabled';
                    showToastNotification('size', 'ðŸ“ Size Chart Sync', `Size chart sync ${status}`);
                });
            }
            
            if (orderTrackingToggle) {
                orderTrackingToggle.addEventListener('change', function() {
                    const status = this.checked ? 'enabled' : 'disabled';
                    showToastNotification('customer', 'ðŸ‘¥ Order Tracking', `Order tracking ${status}`);
                });
            }
        });

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('settingsModal');
            if (modal && event.target === modal) {
                closeSettings();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeSettings();
            }
        });

        // Notification system with toast notifications
        function toggleNotifications() {
            // Clear notification badge when bell is clicked
            if (window.dashboardState) {
                window.dashboardState.clearNotificationBadge();
            }
            
            // Show a toast notification with specific notification types
            const notifications = dashboardState.notifications;
            if (notifications.length > 0) {
                const latestNotification = notifications[0];
                const notificationTitle = dashboardState.getNotificationTitle(latestNotification.type);
                showToastNotification(latestNotification.type, notificationTitle, latestNotification.message);
            } else {
                showToastNotification('info', 'â„¹ï¸ Notifications', 'No new notifications');
            }
        }

        function showToastNotification(type, title, message) {
            const notification = document.createElement('div');
            notification.className = 'notification-toast';
            
            const iconMap = {
                success: 'âœ…',
                info: 'â„¹ï¸',
                warning: 'âš ï¸',
                error: 'âŒ'
            };
            
            notification.innerHTML = `
                <div class="notification-toast-header">
                    <div class="notification-toast-icon ${type}">
                        ${iconMap[type]}
                    </div>
                    <div class="notification-toast-content">
                        <h4 class="notification-toast-title">${title}</h4>
                    </div>
                    <button class="notification-toast-close" onclick="this.parentElement.parentElement.remove()">
                        Ã—
                    </button>
                </div>
                <div class="notification-toast-body">
                    <p class="notification-toast-message">${message}</p>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Clear notification badge when toast appears
            if (window.dashboardState) {
                window.dashboardState.clearNotificationBadge();
            }
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Auto-hide after 4 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }, 4000);
        }

        function loadNotifications() {
            const notificationList = document.getElementById('notificationList');
            if (!notificationList) return;
            
            if (dashboardState.notifications.length === 0) {
                notificationList.innerHTML = `
                    <div class="notification-empty">
                        <div class="notification-empty-icon">ðŸ””</div>
                        <p>No notifications yet</p>
                    </div>
                `;
                return;
            }
            
            notificationList.innerHTML = dashboardState.notifications.map(notification => `
                <div class="notification-item" onclick="markAsRead(${notification.id})">
                    <div class="notification-content">
                        <div class="notification-icon ${notification.type}">
                            ${notification.icon}
                        </div>
                        <div class="notification-text">
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${notification.time}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function markAsRead(notificationId) {
            dashboardState.removeNotification(notificationId);
        }

        // Close notification panel when clicking outside
        document.addEventListener('click', function(event) {
            const panel = document.getElementById('notificationPanel');
            const bell = document.querySelector('.notification-bell');
            
            if (panel && bell && !panel.contains(event.target) && !bell.contains(event.target)) {
                panel.classList.remove('show');
            }
        });

        // Date Filter Functions
        function setQuickFilter(period, button) {
            try {
                const today = new Date();
                const fromDateInput = document.getElementById('analyticsFromDate');
                const toDateInput = document.getElementById('analyticsToDate');
                
                if (!fromDateInput || !toDateInput) {
                    console.error('Date inputs not found');
                    return;
                }
                
                // Remove active class from all buttons
                document.querySelectorAll('.quick-filter-btn').forEach(btn => btn.classList.remove('active'));
                // Add active class to clicked button
                if (button) {
                    button.classList.add('active');
                }
                
                let fromDate, toDate;
                
                switch(period) {
                    case 'today':
                        fromDate = toDate = today;
                        break;
                    case 'week':
                        fromDate = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                        toDate = today;
                        break;
                    case 'month':
                        fromDate = new Date(today.getFullYear(), today.getMonth(), 1);
                        toDate = today;
                        break;
                    case 'quarter':
                        const quarterStart = Math.floor(today.getMonth() / 3) * 3;
                        fromDate = new Date(today.getFullYear(), quarterStart, 1);
                        toDate = today;
                        break;
                    case 'year':
                        fromDate = new Date(today.getFullYear(), 0, 1);
                        toDate = today;
                        break;
                    case 'all':
                        fromDate = null;
                        toDate = null;
                        break;
                }
                
                if (fromDate && toDate) {
                    fromDateInput.value = fromDate.toISOString().split('T')[0];
                    toDateInput.value = toDate.toISOString().split('T')[0];
                } else {
                    fromDateInput.value = '';
                    toDateInput.value = '';
                }
            } catch (error) {
                console.error('Error setting quick filter:', error);
                showError('Failed to set quick filter. Please try again.');
            }
        }

        function applyFilters(button) {
            try {
                const fromDate = document.getElementById('analyticsFromDate')?.value;
                const toDate = document.getElementById('analyticsToDate')?.value;
                const month = document.getElementById('analyticsMonth')?.value;
                const year = document.getElementById('analyticsYear')?.value;
                
                // Validate date range
                if (fromDate && toDate && new Date(fromDate) > new Date(toDate)) {
                    showError('From date cannot be later than To date');
                    return;
                }
                
                // Show loading state
                if (button) {
                    const originalText = button.innerHTML;
                    button.innerHTML = 'â³ Applying...';
                    button.disabled = true;
                    
                    // Simulate filter processing
                    setTimeout(() => {
                        // Update KPI cards based on filters
                        updateKPICards(fromDate, toDate, month, year);
                        
                        // Update size distribution
                        updateSizeDistribution(fromDate, toDate, month, year);
                        
                        // Update production insights
                        updateProductionInsights(fromDate, toDate, month, year);
                        
                        // Reset button
                        button.innerHTML = originalText;
                        button.disabled = false;
                        
                        // Show success message
                        showSuccess('Filters applied successfully! Dashboard updated with filtered data.');
                        
                        // Add notification
                        dashboardState.addMajorNotification('success', 'Analytics filters applied successfully', 'ðŸ“Š');
                    }, 1500);
                }
            } catch (error) {
                console.error('Error applying filters:', error);
                showError('Failed to apply filters. Please try again.');
                if (button) {
                    button.disabled = false;
                    button.innerHTML = 'ðŸ” Apply Filters';
                }
            }
        }
        
        function updateKPICards(fromDate, toDate, month, year) {
            try {
                // Simulate filtered data based on date range
                let totalOrders = 3;
                let uniqueCustomers = 1;
                let mostPopularSize = 'L';
                let returnReduction = '32%';
                
                if (fromDate && toDate) {
                    const daysDiff = Math.ceil((new Date(toDate) - new Date(fromDate)) / (1000 * 60 * 60 * 24));
                    if (daysDiff < 7) {
                        totalOrders = 1;
                        uniqueCustomers = 1;
                    } else if (daysDiff < 30) {
                        totalOrders = 2;
                        uniqueCustomers = 1;
                    }
                }
                
                if (month && month !== '') {
                    totalOrders = Math.floor(totalOrders * 0.8);
                    returnReduction = '28%';
                }
                
                // Update KPI cards with animation
                animateValue('totalOrders', totalOrders);
                animateValue('uniqueCustomers', uniqueCustomers);
                animateValue('mostPopularSize', mostPopularSize);
                animateValue('returnReduction', returnReduction);
            } catch (error) {
                console.error('Error updating KPI cards:', error);
            }
        }
        
        function animateValue(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.transform = 'scale(1.1)';
                element.textContent = newValue;
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                }, 200);
            }
        }
        
        function updateSizeDistribution(fromDate, toDate, month, year) {
            try {
                // Update chart placeholder with filter info
                const chartPlaceholder = document.querySelector('.card:nth-child(3) .card > div:last-child');
                if (chartPlaceholder) {
                    const filterText = fromDate ? `${fromDate} to ${toDate}` : 'All dates';
                    const monthText = month ? ` | ${month}` : '';
                    const yearText = year ? ` | ${year}` : '';
                    
                    chartPlaceholder.innerHTML = `
                        <div style="font-size: 1.5rem; margin-bottom: 1rem;">ðŸ“Š</div>
                        <h3 style="color: #4a5568; margin-bottom: 0.5rem;">Size Recommendations Distribution</h3>
                        <p style="color: #718096;">Chart filtered by: ${filterText}${monthText}${yearText}</p>
                    `;
                }
            } catch (error) {
                console.error('Error updating size distribution:', error);
            }
        }
        
        function updateProductionInsights(fromDate, toDate, month, year) {
            try {
                // Update table data based on filters
                const tableRows = document.querySelectorAll('.insights-table tbody tr');
                tableRows.forEach((row, index) => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 3) {
                        // Simulate filtered percentages
                        const percentages = ['33.3%', '33.3%', '33.3%'];
                        if (fromDate && toDate) {
                            const daysDiff = Math.ceil((new Date(toDate) - new Date(fromDate)) / (1000 * 60 * 60 * 24));
                            if (daysDiff < 7) {
                                percentages[index] = '100%';
                            }
                        }
                        cells[2].textContent = percentages[index];
                    }
                });
                
                // Update recommendations
                const topPerformersMetric = document.querySelector('.recommendation-card.top-performers .recommendation-metric');
                const highDemandMetric = document.querySelector('.recommendation-card.high-demand .recommendation-metric');
                
                if (topPerformersMetric && highDemandMetric) {
                    if (fromDate && toDate) {
                        const daysDiff = Math.ceil((new Date(toDate) - new Date(fromDate)) / (1000 * 60 * 60 * 24));
                        if (daysDiff < 7) {
                            topPerformersMetric.textContent = '100%';
                            highDemandMetric.textContent = '1';
                        } else if (daysDiff < 30) {
                            topPerformersMetric.textContent = '75%';
                            highDemandMetric.textContent = '2';
                        }
                    }
                }
            } catch (error) {
                console.error('Error updating production insights:', error);
            }
        }

        function clearFilters() {
            try {
                // Clear analytics filters
                document.getElementById('analyticsFromDate').value = '';
                document.getElementById('analyticsToDate').value = '';
                document.getElementById('analyticsMonth').value = '';
                document.getElementById('analyticsYear').value = '';
                
                // Remove active class from quick filter buttons
                document.querySelectorAll('.quick-filter-btn').forEach(btn => btn.classList.remove('active'));
                
                // Reset KPI cards to original values
                updateKPICards('', '', '', '');
                updateSizeDistribution('', '', '', '');
                updateProductionInsights('', '', '', '');
                
                showSuccess('Filters cleared!');
            } catch (error) {
                console.error('Error clearing filters:', error);
                showError('Failed to clear filters. Please try again.');
            }
        }

        function exportData() {
            try {
                // Export analytics data (KPI cards and insights)
                const exportData = {
                    'Total Orders': document.getElementById('totalOrders')?.textContent || '3',
                    'Unique Customers': document.getElementById('uniqueCustomers')?.textContent || '1',
                    'Most Popular Size': document.getElementById('mostPopularSize')?.textContent || 'L',
                    'Est. Return Reduction': document.getElementById('returnReduction')?.textContent || '32%',
                    'Size L Recommendations': '1 (33.3%)',
                    'Size M Recommendations': '1 (33.3%)',
                    'Size S Recommendations': '1 (33.3%)',
                    'Top Performers': '66.6%',
                    'High Demand Sizes': '3',
                    'Data Confidence': 'LOW - Early stage data (3 measurements)'
                };
                
                // Create CSV content
                let csvContent = 'Metric,Value\n';
                Object.entries(exportData).forEach(([key, value]) => {
                    csvContent += `"${key}","${value}"\n`;
                });
                
                // Create and download file
                downloadCSV(csvContent, 'analytics_data_' + new Date().toISOString().split('T')[0] + '.csv');
                
                showSuccess('Analytics data exported successfully!');
                dashboardState.addMajorNotification('success', 'Analytics data exported', 'ðŸ“Š');
            } catch (error) {
                console.error('Error exporting data:', error);
                showError('Failed to export data. Please try again.');
            }
        }

        function exportSizeDistribution() {
            try {
                // Export size distribution data
                const sizeData = [
                    ['Size', 'Recommendations', 'Percentage', 'Avg Bust', 'Avg Waist', 'Avg Hip', 'Production Priority'],
                    ['L', '1', '33.3%', '37.0"', '30.0"', '35.0"', 'HIGH'],
                    ['M', '1', '33.3%', '35.0"', '25.0"', '35.0"', 'HIGH'],
                    ['S', '1', '33.3%', '33.0"', '20.0"', '31.0"', 'HIGH']
                ];
                
                // Create CSV content
                let csvContent = '';
                sizeData.forEach(row => {
                    csvContent += row.map(cell => `"${cell}"`).join(',') + '\n';
                });
                
                // Create and download file
                downloadCSV(csvContent, 'size_distribution_' + new Date().toISOString().split('T')[0] + '.csv');
                
                showSuccess('Size distribution data exported successfully!');
                dashboardState.addMajorNotification('success', 'Size distribution exported', 'ðŸ“Š');
            } catch (error) {
                console.error('Error exporting size distribution:', error);
                showError('Failed to export size distribution. Please try again.');
            }
        }

        // Customer Database Functions
        function clearCustomerFilters() {
            try {
                // Clear customer filters
                document.getElementById('customerFromDate').value = '';
                document.getElementById('customerToDate').value = '';
                document.getElementById('customerMonth').value = '';
                document.getElementById('customerYear').value = '';
                document.getElementById('customerSize').value = '';
                
                // Show all rows
                const tableRows = document.querySelectorAll('.customer-table tbody tr');
                tableRows.forEach(row => {
                    row.style.display = '';
                });
                
                // Reset count
                dashboardState.filteredCustomerCount = dashboardState.totalCustomers;
                updateCustomerCount();
                
                showSuccess('Customer filters cleared!');
            } catch (error) {
                console.error('Error clearing customer filters:', error);
                showError('Failed to clear customer filters. Please try again.');
            }
        }

        function applyCustomerFilters(button) {
            try {
                const fromDate = document.getElementById('customerFromDate')?.value;
                const toDate = document.getElementById('customerToDate')?.value;
                const month = document.getElementById('customerMonth')?.value;
                const year = document.getElementById('customerYear')?.value;
                const size = document.getElementById('customerSize')?.value;
                
                console.log('Applying customer filters:', { fromDate, toDate, month, year, size });
                
                // Validate date range
                if (fromDate && toDate && new Date(fromDate) > new Date(toDate)) {
                    showError('From date cannot be later than To date');
                    return;
                }
                
                // Show loading state
                if (button) {
                    const originalText = button.innerHTML;
                    button.innerHTML = 'â³ Applying...';
                    button.disabled = true;
                    
                    // Simulate filter processing
                    setTimeout(() => {
                        // Filter table rows based on criteria
                        filterCustomerTable(fromDate, toDate, month, year, size);
                        
                        // Update customer count
                        updateCustomerCount();
                        
                        // Reset button first
                        button.innerHTML = originalText;
                        button.disabled = false;
                        
                        // Show success message after button is reset
                        setTimeout(() => {
                            showSuccess('Customer filters applied successfully!');
                            dashboardState.addMajorNotification('success', 'Customer filters applied', 'ðŸ‘¥');
                        }, 100);
                    }, 1500);
                }
            } catch (error) {
                console.error('Error applying customer filters:', error);
                showError('Failed to apply customer filters. Please try again.');
                if (button) {
                    button.disabled = false;
                    button.innerHTML = 'ðŸ” Apply Filters';
                }
            }
        }

        // Load customer data from Shopify REST API
        async function loadCustomerData() {
            try {
                console.log('ðŸ”„ Loading customer data from Shopify REST API...');
                
                // Try Shopify REST API first
                const apiBaseUrl = window.location.hostname === 'localhost' 
                    ? 'http://localhost:3001/api' 
                    : 'https://ideal-fit-app1.onrender.com/api';
                const response = await fetch(`${apiBaseUrl}/shopify-rest-customers?limit=50`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        if (data.fallback) {
                            console.log('âš ï¸ Using fallback customer data:', data.message);
                        } else {
                            console.log('âœ… Customer data loaded from Shopify REST API');
                        }
                        updateCustomerTableWithShopifyData(data.data);
                        return;
                    }
                }
                
                // Fallback to local API
                console.log('âš ï¸ Shopify REST API unavailable, using local customer data');
                const localResponse = await fetch(`${apiBaseUrl}/customers?shop=idealfit-2.myshopify.com`);
                if (localResponse.ok) {
                    const localData = await localResponse.json();
                    if (localData.success) {
                        console.log('âœ… Customer data loaded from local API:', localData.data);
                        updateCustomerTable(localData.data);
                        return;
                    }
                }
                
                console.log('âš ï¸ Both APIs failed, keeping existing static data');
                
            } catch (error) {
                console.error('âŒ Error loading customer data:', error);
                // Keep existing static data as fallback
            }
        }
        
        // Update customer table with Shopify data
        function updateCustomerTableWithShopifyData(customers) {
            const tbody = document.querySelector('.customer-table tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            customers.forEach(customer => {
                const row = document.createElement('tr');
                
                // Format date
                const orderDate = customer.statistics.lastOrderDate || customer.createdAt;
                
                // Get customer name
                const customerName = `${customer.firstName} ${customer.lastName}`.trim();
                
                // Get address info
                const address = customer.defaultAddress;
                const address1 = address ? address.address1 : '';
                const city = address ? address.city : '';
                const province = address ? address.province : '';
                const country = address ? address.country : '';
                
                // For now, use default measurements since Shopify doesn't store size measurements
                const measurements = {
                    bust: '34',
                    waist: '28',
                    hip: '36',
                    recommendedSize: 'M'
                };
                
                // Get size badge class
                const sizeClass = `size-${measurements.recommendedSize.toLowerCase()}`;
                
                row.innerHTML = `
                    <td>${orderDate}</td>
                    <td><strong>${customerName}</strong></td>
                    <td>${customer.email}</td>
                    <td>${customer.phone || ''}</td>
                    <td>${address1}</td>
                    <td>${city}</td>
                    <td>${province}</td>
                    <td>${country}</td>
                    <td>${measurements.bust}"</td>
                    <td>${measurements.waist}"</td>
                    <td>${measurements.hip}"</td>
                    <td><span class="size-badge ${sizeClass}">${measurements.recommendedSize}</span></td>
                    <td>${customer.id}</td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Update count display
            const countElement = document.querySelector('.customer-table').parentElement.querySelector('div[style*="color: #6b7280"]');
            if (countElement) {
                countElement.textContent = `Showing ${customers.length} of ${customers.length} customers`;
            }
        }
        
        // Update customer table with API data
        function updateCustomerTable(customers) {
            const tbody = document.querySelector('.customer-table tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            customers.forEach(customer => {
                const row = document.createElement('tr');
                
                // Format date
                const orderDate = customer.lastOrderDate || customer.createdAt;
                
                // Get size badge class
                const sizeClass = `size-${customer.measurements.recommendedSize.toLowerCase()}`;
                
                row.innerHTML = `
                    <td>${orderDate}</td>
                    <td><strong>${customer.name}</strong></td>
                    <td>${customer.email}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.address}</td>
                    <td>${customer.city}</td>
                    <td>${customer.state}</td>
                    <td>${customer.country}</td>
                    <td>${customer.measurements.bust}"</td>
                    <td>${customer.measurements.waist}"</td>
                    <td>${customer.measurements.hip}"</td>
                    <td><span class="size-badge ${sizeClass}">${customer.measurements.recommendedSize}</span></td>
                    <td>${customer.id}</td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Update count display
            const countElement = document.querySelector('.customer-table').parentElement.querySelector('div[style*="color: #6b7280"]');
            if (countElement) {
                countElement.textContent = `Showing ${customers.length} of ${customers.length} customers`;
            }
        }

        function filterCustomerTable(fromDate, toDate, month, year, size) {
            try {
                const tableRows = document.querySelectorAll('.customer-table tbody tr');
                let visibleCount = 0;
                
                console.log('Filtering table with', tableRows.length, 'rows');
                
                tableRows.forEach((row, index) => {
                    const cells = row.querySelectorAll('td');
                    let showRow = true;
                    
                    console.log(`Row ${index}:`, cells.length, 'cells');
                    
                    // Filter by date
                    if (fromDate || toDate) {
                        const rowDate = cells[0].textContent.trim();
                        console.log('Row date:', rowDate, 'From:', fromDate, 'To:', toDate);
                        
                        if (fromDate && rowDate < fromDate) {
                            showRow = false;
                            console.log('Hidden by from date');
                        }
                        if (toDate && rowDate > toDate) {
                            showRow = false;
                            console.log('Hidden by to date');
                        }
                    }
                    
                    // Filter by size
                    if (size && size !== '') {
                        const sizeCell = cells[11]; // Recommended size column
                        const sizeBadge = sizeCell.querySelector('.size-badge');
                        if (sizeBadge) {
                            const rowSize = sizeBadge.textContent.trim();
                            console.log('Row size:', rowSize, 'Filter size:', size);
                            if (rowSize !== size) {
                                showRow = false;
                                console.log('Hidden by size filter');
                            }
                        } else {
                            console.log('No size badge found in row', index);
                        }
                    }
                    
                    // Filter by month
                    if (month && month !== '') {
                        try {
                            const rowDate = new Date(cells[0].textContent.trim());
                            const rowMonth = rowDate.toLocaleString('default', { month: 'long' });
                            console.log('Row month:', rowMonth, 'Filter month:', month);
                            if (rowMonth !== month) {
                                showRow = false;
                                console.log('Hidden by month filter');
                            }
                        } catch (error) {
                            console.log('Error parsing date for month filter:', error);
                        }
                    }
                    
                    // Filter by year
                    if (year && year !== '') {
                        try {
                            const rowDate = new Date(cells[0].textContent.trim());
                            const rowYear = rowDate.getFullYear().toString();
                            console.log('Row year:', rowYear, 'Filter year:', year);
                            if (rowYear !== year) {
                                showRow = false;
                                console.log('Hidden by year filter');
                            }
                        } catch (error) {
                            console.log('Error parsing date for year filter:', error);
                        }
                    }
                    
                    if (showRow) {
                        row.style.display = '';
                        visibleCount++;
                        console.log('Row', index, 'visible');
                    } else {
                        row.style.display = 'none';
                        console.log('Row', index, 'hidden');
                    }
                });
                
                console.log('Visible count:', visibleCount);
                dashboardState.filteredCustomerCount = visibleCount;
            } catch (error) {
                console.error('Error filtering customer table:', error);
                showError('Failed to filter customer table. Please try again.');
            }
        }

        function updateCustomerCount() {
            try {
                const countElement = document.getElementById('customerCount');
                if (countElement) {
                    const totalCustomers = dashboardState.totalCustomers;
                    const visibleCustomers = dashboardState.filteredCustomerCount;
                    
                    console.log('Updating count:', visibleCustomers, 'of', totalCustomers);
                    countElement.textContent = `Showing ${visibleCustomers} of ${totalCustomers} customers`;
                }
            } catch (error) {
                console.error('Error updating customer count:', error);
            }
        }

        function exportCustomerData() {
            try {
                // Get visible table data only
                const table = document.querySelector('.customer-table');
                const rows = table.querySelectorAll('tr');
                
                // Create CSV content
                let csvContent = '';
                
                // Add headers
                const headers = [];
                rows[0].querySelectorAll('th').forEach(th => {
                    headers.push(th.textContent.trim());
                });
                csvContent += headers.join(',') + '\n';
                
                // Add data rows (only visible ones)
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (row.style.display === 'none') continue; // Skip hidden rows
                    
                    const cells = row.querySelectorAll('td');
                    const rowData = [];
                    
                    cells.forEach(cell => {
                        let cellText = cell.textContent.trim();
                        // Remove size badge styling and get just the size
                        if (cell.querySelector('.size-badge')) {
                            cellText = cell.querySelector('.size-badge').textContent.trim();
                        }
                        // Escape commas and quotes
                        cellText = cellText.replace(/"/g, '""');
                        if (cellText.includes(',') || cellText.includes('"') || cellText.includes('\n')) {
                            cellText = '"' + cellText + '"';
                        }
                        rowData.push(cellText);
                    });
                    
                    csvContent += rowData.join(',') + '\n';
                }
                
                // Create and download file
                downloadCSV(csvContent, 'customer_measurements_' + new Date().toISOString().split('T')[0] + '.csv');
                
                showSuccess('Customer data exported successfully!');
                dashboardState.addMajorNotification('success', 'Customer data exported', 'ðŸ‘¥');
            } catch (error) {
                console.error('Error exporting customer data:', error);
                showError('Failed to export customer data. Please try again.');
            }
        }

        // Utility Functions
        function downloadCSV(csvContent, filename) {
            try {
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Error downloading CSV:', error);
                throw error;
            }
        }

        function showError(message) {
            // Remove existing messages
            document.querySelectorAll('.error-message, .success-message').forEach(msg => msg.remove());
            
            // Create error message
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            
            // Insert at the top of main content
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                mainContent.insertBefore(errorDiv, mainContent.firstChild);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    errorDiv.remove();
                }, 5000);
            }
        }

        function showSuccess(message) {
            // Remove existing messages
            document.querySelectorAll('.error-message, .success-message').forEach(msg => msg.remove());
            
            // Create success message
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            
            // Insert at the top of main content
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                mainContent.insertBefore(successDiv, mainContent.firstChild);
                
                // Auto-remove after 3 seconds
                setTimeout(() => {
                    successDiv.remove();
                }, 3000);
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('ðŸŽ¯ IdealFit Merchant Dashboard Enhanced Version Loaded Successfully!');
                
                // Restore saved tab first
                restoreSavedTab();
                
                // Initialize notification system
                if (typeof dashboardState !== 'undefined') {
                    dashboardState.updateNotificationCount();
                    loadNotifications();
                }
                
                // Initialize dynamic analytics
                try {
                    initializeDynamicAnalytics();
                } catch (error) {
                    console.warn('Dynamic analytics initialization failed:', error);
                }
                
                // Initialize size chart manager
                try {
                    initializeSizeChart();
                } catch (error) {
                    console.warn('Size chart initialization failed:', error);
                }
                
                // Initialize billing manager
                try {
                    initializeBilling();
                } catch (error) {
                    console.warn('Billing manager initialization failed:', error);
                }
                
                // Load customer data from API
                try {
                    loadCustomerData();
                } catch (error) {
                    console.warn('Customer data loading failed:', error);
                }
                
                // Set default dates (with null checks)
                try {
                    const today = new Date();
                    const lastWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    
                    const fromDateEl = document.getElementById('analyticsFromDate');
                    const toDateEl = document.getElementById('analyticsToDate');
                    
                    if (fromDateEl) {
                        fromDateEl.value = lastWeek.toISOString().split('T')[0];
                    }
                    if (toDateEl) {
                        toDateEl.value = today.toISOString().split('T')[0];
                    }
                } catch (error) {
                    console.warn('Date initialization failed:', error);
                }
                
                // Add welcome notification
                if (typeof dashboardState !== 'undefined') {
                    dashboardState.addMajorNotification('info', 'Welcome to IdealFit Merchant Dashboard!', 'ðŸŽ¯');
                }
                
                console.log('âœ… Dashboard initialization completed');
            } catch (error) {
                console.error('Error initializing dashboard:', error);
                showError('Failed to initialize dashboard. Please refresh the page.');
            }
        });

        // Enhanced functionality for all pages
        function initializeEnhancedFeatures() {
            console.log('ðŸš€ Initializing enhanced features...');
            
            // Initialize real-time data updates
            startRealTimeDataUpdates();
            
            // Initialize form validation
            initializeFormValidation();
            
            // Initialize interactive elements
            initializeInteractiveElements();
            
            // Initialize data persistence
            initializeDataPersistence();
            
            // Initialize advanced analytics
            initializeAdvancedAnalytics();
            
            console.log('âœ… Enhanced features initialized successfully!');
        }

        // Real-time data updates
        function startRealTimeDataUpdates() {
            setInterval(() => {
                updateRealTimeKPIs();
                updateRealTimeCharts();
                updateRealTimeActivity();
            }, 30000); // Update every 30 seconds
        }

        // Update real-time KPIs
        function updateRealTimeKPIs() {
            const kpiCards = document.querySelectorAll('.stat-card');
            kpiCards.forEach(card => {
                const numberElement = card.querySelector('.stat-number');
                if (numberElement) {
                    const currentValue = parseInt(numberElement.textContent) || 0;
                    const newValue = currentValue + Math.floor(Math.random() * 5) - 2;
                    animateNumberChange(numberElement, currentValue, Math.max(0, newValue));
                }
            });
        }

        // Animate number changes
        function animateNumberChange(element, start, end) {
            const duration = 1000;
            const startTime = performance.now();
            
            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = Math.floor(start + (end - start) * progress);
                element.textContent = current;
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            requestAnimationFrame(updateNumber);
        }

        // Update real-time charts
        function updateRealTimeCharts() {
            if (window.sizeChart) {
                const newData = window.sizeChart.data.datasets[0].data.map(value => 
                    Math.max(0, value + Math.floor(Math.random() * 10) - 5)
                );
                window.sizeChart.data.datasets[0].data = newData;
                window.sizeChart.update('active');
            }
        }

        // Update real-time activity
        function updateRealTimeActivity() {
            const activityItems = [
                'New customer measurement received',
                'Payment processed successfully',
                'Size chart updated',
                'Data synchronized with Shopify',
                'Analytics data refreshed',
                'New order received',
                'Customer feedback submitted',
                'Inventory updated'
            ];
            
            const randomActivity = activityItems[Math.floor(Math.random() * activityItems.length)];
            addActivityItem(randomActivity);
        }

        // Add activity item
        function addActivityItem(message) {
            const activityContainer = document.querySelector('.activity-feed') || createActivityFeed();
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item';
            activityItem.innerHTML = `
                <div class="activity-icon">ðŸ”„</div>
                <div class="activity-content">
                    <div class="activity-message">${message}</div>
                    <div class="activity-time">Just now</div>
                </div>
            `;
            
            activityContainer.insertBefore(activityItem, activityContainer.firstChild);
            
            // Keep only last 10 items
            const items = activityContainer.querySelectorAll('.activity-item');
            if (items.length > 10) {
                items[items.length - 1].remove();
            }
        }

        // Create activity feed if it doesn't exist
        function createActivityFeed() {
            const activityFeed = document.createElement('div');
            activityFeed.className = 'activity-feed';
            activityFeed.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                width: 300px;
                max-height: 400px;
                overflow-y: auto;
                background: white;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
                border: 1px solid #e5e7eb;
                z-index: 1000;
                display: none;
            `;
            
            document.body.appendChild(activityFeed);
            return activityFeed;
        }

        // Initialize form validation
        function initializeFormValidation() {
            document.querySelectorAll('input, select, textarea').forEach(input => {
                input.addEventListener('blur', validateField);
                input.addEventListener('input', validateField);
            });
        }

        // Validate individual field
        function validateField(event) {
            const field = event.target;
            const value = field.value.trim();
            
            // Remove existing validation classes
            field.classList.remove('valid', 'invalid');
            
            if (!value) return;
            
            let isValid = true;
            let errorMessage = '';
            
            switch (field.type) {
                case 'email':
                    isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
                    errorMessage = 'Please enter a valid email address';
                    break;
                case 'password':
                    isValid = value.length >= 8;
                    errorMessage = 'Password must be at least 8 characters';
                    break;
                case 'number':
                    isValid = !isNaN(value) && value >= 0;
                    errorMessage = 'Please enter a valid positive number';
                    break;
                case 'tel':
                    isValid = /^[\+]?[1-9][\d]{0,15}$/.test(value.replace(/[\s\-\(\)]/g, ''));
                    errorMessage = 'Please enter a valid phone number';
                    break;
            }
            
            if (isValid) {
                field.classList.add('valid');
                removeFieldError(field);
            } else {
                field.classList.add('invalid');
                showFieldError(field, errorMessage);
            }
        }

        // Show field error
        function showFieldError(field, message) {
            removeFieldError(field);
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'field-error';
            errorDiv.textContent = message;
            errorDiv.style.cssText = `
                color: #ef4444;
                font-size: 0.75rem;
                margin-top: 0.25rem;
                display: block;
            `;
            
            field.parentNode.appendChild(errorDiv);
        }

        // Remove field error
        function removeFieldError(field) {
            const existingError = field.parentNode.querySelector('.field-error');
            if (existingError) {
                existingError.remove();
            }
        }

        // Initialize interactive elements
        function initializeInteractiveElements() {
            // Add hover effects to all cards
            document.querySelectorAll('.card, .widget, .stat-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                    this.style.boxShadow = '0 8px 30px rgba(0, 0, 0, 0.12)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.08)';
                });
            });
            
            // Add click effects to buttons
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', function() {
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 150);
                });
            });
        }

        // Initialize data persistence
        function initializeDataPersistence() {
            // Auto-save form data
            document.querySelectorAll('input, select, textarea').forEach(field => {
                // Load saved data
                const savedValue = localStorage.getItem(`field_${field.name || field.id}`);
                if (savedValue) {
                    field.value = savedValue;
                }
                
                // Save data on change
                field.addEventListener('input', function() {
                    localStorage.setItem(`field_${this.name || this.id}`, this.value);
                });
            });
            
            // Save dashboard preferences
            const dashboardPrefs = {
                currentTab: dashboardState.currentTab,
                lastUpdate: new Date().toISOString()
            };
            localStorage.setItem('dashboard_preferences', JSON.stringify(dashboardPrefs));
        }

        // Initialize advanced analytics
        function initializeAdvancedAnalytics() {
            // Track user interactions
            document.addEventListener('click', function(event) {
                const element = event.target;
                const interaction = {
                    type: 'click',
                    element: element.tagName,
                    className: element.className,
                    id: element.id,
                    timestamp: new Date().toISOString()
                };
                
                // Store interaction (in real app, send to analytics service)
                console.log('User interaction:', interaction);
            });
            
            // Track form submissions
            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('submit', function(event) {
                    const formData = new FormData(this);
                    const submission = {
                        type: 'form_submission',
                        formId: this.id,
                        data: Object.fromEntries(formData),
                        timestamp: new Date().toISOString()
                    };
                    
                    console.log('Form submission:', submission);
                });
            });
        }

        // Enhanced export functionality
        function enhancedExportData(format) {
            const exportData = {
                timestamp: new Date().toISOString(),
                format: format,
                data: gatherExportData()
            };
            
            switch (format) {
                case 'csv':
                    exportToCSV(exportData);
                    break;
                case 'excel':
                    exportToExcel(exportData);
                    break;
                case 'pdf':
                    exportToPDF(exportData);
                    break;
                default:
                    showToastNotification('error', 'âŒ Error', 'Unsupported export format');
            }
        }

        // Gather export data
        function gatherExportData() {
            const data = {
                kpis: getKPIData(),
                customers: getCustomerData(),
                analytics: getAnalyticsData(),
                sizeChart: getSizeChartData()
            };
            
            return data;
        }

        // Get KPI data
        function getKPIData() {
            const kpis = {};
            document.querySelectorAll('.stat-card').forEach(card => {
                const label = card.querySelector('.stat-label').textContent;
                const value = card.querySelector('.stat-number').textContent;
                kpis[label] = value;
            });
            return kpis;
        }

        // Get customer data
        function getCustomerData() {
            const customers = [];
            document.querySelectorAll('.customer-table tbody tr').forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 0) {
                    customers.push({
                        date: cells[0].textContent,
                        name: cells[1].textContent,
                        email: cells[2].textContent,
                        mobile: cells[3].textContent,
                        address: cells[4].textContent,
                        city: cells[5].textContent,
                        state: cells[6].textContent,
                        country: cells[7].textContent,
                        bust: cells[8].textContent,
                        waist: cells[9].textContent,
                        hip: cells[10].textContent,
                        size: cells[11].textContent,
                        orderId: cells[12].textContent
                    });
                }
            });
            return customers;
        }

        // Get analytics data
        function getAnalyticsData() {
            return {
                chartData: window.sizeChart ? window.sizeChart.data : null,
                filters: getActiveFilters(),
                dateRange: getDateRange()
            };
        }

        // Get size chart data
        function getSizeChartData() {
            const sizeData = [];
            document.querySelectorAll('.size-chart-table tbody tr').forEach(row => {
                const inputs = row.querySelectorAll('input');
                if (inputs.length >= 4) {
                    sizeData.push({
                        size: inputs[0].value,
                        bust: inputs[1].value,
                        waist: inputs[2].value,
                        hip: inputs[3].value
                    });
                }
            });
            return sizeData;
        }

        // Get active filters
        function getActiveFilters() {
            const filters = {};
            document.querySelectorAll('.quick-filter-btn.active').forEach(btn => {
                filters[btn.textContent] = true;
            });
            return filters;
        }

        // Get date range
        function getDateRange() {
            return {
                from: document.getElementById('analyticsFromDate')?.value,
                to: document.getElementById('analyticsToDate')?.value
            };
        }

        // Enhanced CSV export
        function exportToCSV(data) {
            const csvContent = convertToCSV(data.data);
            downloadFile(csvContent, `ideal-fit-data-${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
            showToastNotification('success', 'ðŸ“Š Export Complete', 'Data exported to CSV successfully!');
        }

        // Convert data to CSV
        function convertToCSV(data) {
            let csv = 'Type,Label,Value\n';
            
            // Add KPI data
            Object.entries(data.kpis).forEach(([label, value]) => {
                csv += `KPI,"${label}","${value}"\n`;
            });
            
            // Add customer data
            data.customers.forEach(customer => {
                csv += `Customer,"${customer.name}","${customer.email}","${customer.mobile}","${customer.address}","${customer.city}","${customer.state}","${customer.country}","${customer.bust}","${customer.waist}","${customer.hip}","${customer.size}","${customer.orderId}"\n`;
            });
            
            return csv;
        }

        // Enhanced Excel export
        function exportToExcel(data) {
            // In a real implementation, you would use a library like SheetJS
            // For now, we'll create a CSV that can be opened in Excel
            const excelContent = convertToCSV(data);
            downloadFile(excelContent, `ideal-fit-data-${new Date().toISOString().split('T')[0]}.xlsx`, 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
            showToastNotification('success', 'ðŸ“Š Export Complete', 'Data exported to Excel successfully!');
        }

        // Enhanced PDF export
        function exportToPDF(data) {
            // In a real implementation, you would use a library like jsPDF
            // For now, we'll show a placeholder
            showToastNotification('info', 'ðŸ“„ PDF Export', 'PDF export feature coming soon!');
        }

        // Download file utility
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Enhanced search functionality
        function enhancedSearch(query) {
            if (!query.trim()) {
                showAllResults();
                return;
            }
            
            const results = searchData(query);
            displaySearchResults(results);
            showToastNotification('info', 'ðŸ” Search Complete', `Found ${results.length} results for "${query}"`);
        }

        // Search data
        function searchData(query) {
            const results = [];
            const searchTerm = query.toLowerCase();
            
            // Search in customer data
            document.querySelectorAll('.customer-table tbody tr').forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 0) {
                    const rowText = Array.from(cells).map(cell => cell.textContent).join(' ').toLowerCase();
                    if (rowText.includes(searchTerm)) {
                        results.push({
                            type: 'customer',
                            element: row,
                            relevance: calculateRelevance(rowText, searchTerm)
                        });
                    }
                }
            });
            
            // Search in analytics data
            document.querySelectorAll('.insights-table tbody tr').forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 0) {
                    const rowText = Array.from(cells).map(cell => cell.textContent).join(' ').toLowerCase();
                    if (rowText.includes(searchTerm)) {
                        results.push({
                            type: 'analytics',
                            element: row,
                            relevance: calculateRelevance(rowText, searchTerm)
                        });
                    }
                }
            });
            
            return results.sort((a, b) => b.relevance - a.relevance);
        }

        // Calculate search relevance
        function calculateRelevance(text, query) {
            let score = 0;
            const words = query.split(' ');
            
            words.forEach(word => {
                if (text.includes(word)) {
                    score += 1;
                }
            });
            
            return score;
        }

        // Display search results
        function displaySearchResults(results) {
            // Hide all rows first
            document.querySelectorAll('.customer-table tbody tr, .insights-table tbody tr').forEach(row => {
                row.style.display = 'none';
            });
            
            // Show matching rows
            results.forEach(result => {
                result.element.style.display = 'table-row';
                result.element.style.backgroundColor = '#f0f9ff';
            });
        }

        // Show all results
        function showAllResults() {
            document.querySelectorAll('.customer-table tbody tr, .insights-table tbody tr').forEach(row => {
                row.style.display = 'table-row';
                row.style.backgroundColor = '';
            });
        }

        // Enhanced notification system
        function enhancedNotificationSystem() {
            // Add notification categories
            const notificationCategories = {
                'payment': { icon: 'ðŸ’³', color: '#22c55e' },
                'sync': { icon: 'ðŸ”„', color: '#3b82f6' },
                'customer': { icon: 'ðŸ‘¥', color: '#8b5cf6' },
                'analytics': { icon: 'ðŸ“Š', color: '#f59e0b' },
                'system': { icon: 'âš™ï¸', color: '#6b7280' },
                'error': { icon: 'âŒ', color: '#ef4444' },
                'success': { icon: 'âœ…', color: '#22c55e' },
                'warning': { icon: 'âš ï¸', color: '#f59e0b' }
            };
            
            // Enhanced notification display
            function showEnhancedNotification(type, title, message, duration = 4000) {
                const category = notificationCategories[type] || notificationCategories['system'];
                const notification = document.createElement('div');
                notification.className = 'enhanced-notification';
                notification.style.cssText = `
                    position: fixed;
                    top: 100px;
                    right: 20px;
                    background: white;
                    border-radius: 12px;
                    padding: 1rem 1.5rem;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
                    border-left: 4px solid ${category.color};
                    z-index: 1000;
                    transform: translateX(400px);
                    transition: transform 0.3s ease;
                    max-width: 350px;
                `;
                
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <span style="font-size: 1.5rem;">${category.icon}</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #374151; margin-bottom: 0.25rem;">${title}</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">${message}</div>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: #6b7280; cursor: pointer; font-size: 1.25rem;">Ã—</button>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(400px)';
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }, duration);
            }
            
            // Make it globally available
            window.showEnhancedNotification = showEnhancedNotification;
        }

        // Initialize enhanced features when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                initializeEnhancedFeatures();
                enhancedNotificationSystem();
            }, 2000); // Wait for initial dashboard to load
        });

        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            showError('An unexpected error occurred. Please try again.');
        });

        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            showError('An unexpected error occurred. Please try again.');
        });
    </script>
</body>
</html>
